(function(k,p,l,q){'use strict';var a=p.dfm={conf:{},i18n:{},template:{layer:'<div class="dfm-layer"></div>',dataRow:'<div class="data-row"><span class="label"></span><span class="separator">:</span><span class="value"></span></div>'},hooks:{init:{}},tree:{},els:{},tbis:{},_cmis:{},cmis:{},mpos:{left:0,top:0},shortcuts:{main:{ctrl:{}},tree:{ctrl:{}},contents:{ctrl:{}}},cb:{},sorters:{},history:{states:[],current:-1}};a.registerHook=function(b,c,d){a.hooks[b]?a.hooks[b][c]=d:a.hooks[b]={id:d}};a.registerInit=
function(b,c){a.hooks.init[b]=c};a.invoke=function(b){var c,d,e=a.hooks[b],f={};if(e)for(c in d=Array.prototype.slice.call(arguments,1),e)f[c]=e[c].apply(this,d);return f};a.setState=function(b,c,d,e){b[c]=!0;a.addClass(d,c);e&&a.addClass(e,c);return b};a.unsetState=function(b,c,d,e){b[c]=!1;a.removeClass(d,c);e&&a.removeClass(e,c);return b};a.updateElCoords=function(b){var c=a.absPos(b);b.posLeft=c.left;b.posRight=c.left+b.offsetWidth;b.posTop=c.top;b.posBottom=c.top+b.offsetHeight};a.scrollToEl=
function(b,c){if(c.scrollHeight>c.clientHeight){var d,e=a.absPos(b).top,f=e+b.offsetHeight,m=a.absPos(c).top,g=m+c.offsetHeight;if(d=a.scrollToElDiff)m+=d(b,c)||0;e<m?c.scrollTop-=m-e+10:g<f&&(c.scrollTop+=Math.min(f-g+10,e-m-10))}};a.scrollToElDiff=function(b,c){return a.listViewing&&c===a.els.contents?a.els.listHead.offsetHeight:0};a.setScrollHeight=function(b){b.scrollHeight>b.clientHeight&&(b.style.height=b.scrollHeight+"px")};a.setScrollWidth=function(b){b.scrollWidth>b.clientWidth&&(b.style.width=
b.scrollWidth+"px")};a.maxST=function(b){return b.scrollHeight>b.clientHeight?b.scrollHeight-b.clientHeight:0};a.maxSL=function(b){return b.scrollWidth>b.clientWidth?b.scrollWidth-b.clientWidth:0};a.showAt=function(b,c,d){a.setCss(b,c);if(d&&d.effect)k(b)[d.effect]();else a.showEl(b);if(d&&d.fixPos){var e=a.winSize(),f=a.winScroll(),m=a.scrollbarWidth(),g=c.left-f.left+b.offsetWidth-e.width+m,e=c.top-f.top+b.offsetHeight-e.height+m;0<g&&(b.style.left=Math.max(0,c.left-g)+"px");0<e&&(b.style.top=Math.max(0,
c.top-(0<g&&d.shiftTop!==q?b.offsetHeight+d.shiftTop:e))+"px")}};a.scrollbarWidth=function(){var b,c,d=a.scrollbarW;d||(c=l.body,b=a.htmlEl('<div style="width: 50px; height: 50px; position: absolute; left: -100px; top: -100px; overflow: auto;"><div style="width: 1px; height: 100px;"></div></div>'),c.appendChild(b),d=a.scrollbarW=b.offsetWidth-b.clientWidth,c.removeChild(b));return d};a.joinPaths=function(b,a){return"."===b?a:"."===a?b:"/"==b.substr(-1)?b+a:b+"/"+a};a.fileExt=function(b){b=b.split(".");
return 1==b.length?"":b[b.length-1]};a.getFirstIn=function(b,a,d){var e,f;if(!a){for(e in b)return b[e];return!1}d===q&&(d=!0);for(e in b)if(f=b[e],d?f[a]:!f[a])return f;return!1};a.formatItemsStat=function(b,c){return a.t("!items !size",{"!items":1==b?a.t("1 item"):a.t("!count items",{"!count":b}),"!size":a.formatSize(c)})};a.getObjFromEl=function(b,c,d){if(b&&(a.hasClass(b,c)||(b=b.parentNode)&&a.hasClass(b,c)))return b[d]};a.elPerRow=function(b){return Math.max(1,a.int(b.parentNode.clientWidth/
k(b).outerWidth(!0)))};a.formDataObj=function(b){var a,d,e=k(b).serializeArray(),f={};for(a in e)b=e[a].name,d=e[a].value,2<b.length&&"[]"===b.substr(b.length-2)?f[b]===q?f[b]=[d]:f[b].push(d):f[b]=d;return f};a.returnFalse=function(){return!1};a.eMposUpdate=function(b){a.mpos.left=b.pageX;a.mpos.top=b.pageY};a.eOnScrollbar=function(b,c){return c.scrollHeight>c.clientHeight&&b.pageX>c.posRight-a.scrollbarWidth()-1||c.scrollWidth>c.clientWidth&&b.pageY>c.posBottom-a.scrollbarWidth()-1?!0:!1};a.eOnElement=
function(b,a){return b.pageY>a.posTop&&b.pageY<a.posBottom&&b.pageX>a.posLeft&&b.pageX<a.posRight};a.eDragAutoScroll=function(b,a,d,e,f,m){a.maxST&&(b.pageY>f?a.scrollTop<a.maxST&&(a.scrollTop+=Math.min(b.pageY-f,a.maxST-a.scrollTop)):b.pageY<d&&0<a.scrollTop&&(a.scrollTop-=Math.min(d-b.pageY,a.scrollTop)));a.maxSL&&(b.pageX>e?a.scrollLeft<a.maxSL&&(a.scrollLeft+=Math.min(b.pageX-e,a.maxSL-a.scrollLeft)):b.pageX<m&&0<a.scrollLeft&&(a.scrollLeft-=Math.min(m-b.pageX,a.scrollLeft)))};a.eInnerDragAutoScroll=
function(b,c){return(c.maxST||c.maxSL)&&a.eOnElement(b,c)?(a.eDragAutoScroll(b,c,c.posDASTop,c.posDASRight,c.posDASBottom,c.posDASLeft),!0):!1};a.prepareForInnerDragAutoScroll=function(b,c,d){a.setMaxSVals(b);if(b.maxST||b.maxSL)a.updateElCoords(b),b.maxST&&(d=Math.min(b.clientHeight/10,d||32),b.posDASTop=b.posTop+d,b.posDASBottom=b.posBottom-d),b.maxSL&&(c=Math.min(b.clientWidth/10,c||32),b.posDASLeft=b.posLeft+c,b.posDASRight=b.posRight-c)};a.setMaxSVals=function(b){b.maxST=a.maxST(b);b.maxSL=a.maxSL(b)};
a.eSetItemHoverDropState=function(b,c,d){if(b&&a.itemDragging){var e,f=a.draggingDir;(f||!b.selected)&&(e=f?f.parent:a.activeDir)&&(b.appendItem&&a.validateAppendDirItems(f?f.groupSelf():e.groupSelectedItems(),b,c)?a.setCursorDropState(!0):d&&a.setCursorDropState())}};a.setCursorDropState=function(b){var c=a.els.cursorPopup;c&&(b?a.addClass:a.removeClass)(c,"drop-ok")};a.eWinBeforeunload=function(b){if(b=a.activeDir)!b.disabled&&1<k(".branch-head",a.els.tree).not(".disabled").size()&&a.cookie("dfmLAD",
b.path,0),b=a.listViewing,a.cookie("dfmLV",b,b?void 0:-7),b=a.prvWidgetClosed,a.cookie("dfmPWC",b,b?void 0:-7),b=a.lastSortKey,a.cookie("dfmLSK",b,"name"!==b?void 0:-7),b=a.lastSortDir,a.cookie("dfmLSD",b,"asc"!==b?void 0:-7)};a.eWinResize=function(b){b=l.activeElement;if(!b||"TEXTAREA"!==b.tagName&&"text"!==b.type){b=a.els.body;var c=l.body.offsetHeight,d=a.winSize().height;b.style.height=b.clientHeight+(d-c)+"px"}};a.eDocMousemove=function(b){a.eMposUpdate(b)};a.eDocKeydown=function(b){a.itemDragging&&
b.ctrlKey&&!a.ctrlDown&&(a.ctrlDown=1,a.addClass(l.body,"ctrl-down"),a.eSetItemHoverDropState(a.hoveringItem||a.hoveringDir,!0,!0))};a.eDocKeyup=function(b){a.ctrlDown&&!b.ctrlKey&&(a.ctrlDown=0,a.removeClass(l.body,"ctrl-down"),a.eSetItemHoverDropState(a.hoveringItem||a.hoveringDir,!1,!0))};a.eMainKeydown=function(b){return a.eAreaShortcut("main",b)};a.eAreaShortcut=function(b,c){c||(c=p.event);var d="k"+c.keyCode,e;if(c.ctrlKey&&(e=a.shortcuts[b].ctrl[d])||(e=a.shortcuts[b][d]))return e.call(a,
a.eFix(c)),!1};a.eTbiUpClick=function(b){b=a.activeDir;var c=b.parent;c?c.open():b.iscondir&&a.historyGo(0)};a.eTbiRefreshClick=function(b){a.activeDir.load()};a.eTbiSortByClick=function(b){a.initSortBy();setTimeout(a.updateSortBy)};a.eTbiActionsClick=function(b){b=a.activeDir;var c=b.getLastSelectedItem(),d=a.tbis.actions.el,e=a.absPos(d);e.top+=k(d).outerHeight(!0);a.showCM(a.extend(c?{itemCM:!0,cname:"item-cm",Item:c,target:c}:{contentsCM:!0,cname:"contents-cm",target:b},e))};a.eTbiCvClick=function(b){a.setListView(!a.listViewing)};
a.eTbiClClick=function(b){b=a.els.main;var c=a.conf.layouts||["both","left","right","none"],d=b.getAttribute("data-l"),d=a.inArray(d,c);b.setAttribute("data-l",c[-1===d?1:(d+1)%c.length])};a.validateDirPredefined=function(b,c){var d=b.hasPredefinedPath();return d?(c||a.setMessage(a.t("%dirname is a predefined directory and can not be modified.",{"%dirname":d})),!1):!0};a.validateItemsCount=function(b,c,d,e){return b<c?(e||a.setMessage(1==c?a.t("You must select an item."):a.t("You must select at least !count items.",
{"!count":1*c})),!1):d&&b>d?(e||a.setMessage(a.t("You can not select more than !count items.",{"!count":1*d})),!1):!0};a.validateDirItems=function(b,c,d,e,f,m){var g,h,k,l,n=e||f;for(h in b){g=a.tree[h];l=b[h];if(c&&!g.getPerm(c)&&a.getFirstIn(l,"isfile")||d&&!g.getPerm(d)&&a.getFirstIn(l,"isdir"))return!1;if(n)for(k in l)if(g=l[k],e&&!g.isOperable()||f&&g.isdir&&!a.validateDirPredefined(g,m))return!1}return!0};a.validateSelectionCount=function(b,c,d){return a.validateItemsCount(a.activeDir.countSelectedItems(),
b,c,d)};a.validateSelection=function(b,c,d){return a.validateSelectionCount(b,c,d)&&!a.activeDir.getFirstInoperableSelectedItem()};a.validateSelectionCommon=function(b,c,d,e,f){return a.validateSelectionCount(1,0,f)?a.validateDirItems(a.activeDir.groupSelectedItems(),b,c,d,e,f):!1};a.validateSelectedDir=function(b,c,d,e){var f=b.parent;return f&&!f.busy&&b.isOperable()&&(!c||f.getPerm(c))&&(!d||a.validateDirPredefined(b,e))};a.validateFileName=function(b,c,d){if(!b||!b.length||"."===b||".."===b)return!1;
d=!d;var e={"%filename":b};c||(c=a.getFilterOptions()||{});return c.maxFileLength&&b.length>c.maxFileLength?(d&&a.setMessage(a.t("%filename is too long.",e)),!1):c.filterRE&&c.filterRE.test(b)?(d&&a.setMessage(a.t("%filename is forbidden.",e)),!1):/^\s|\s$|[\/\\:\*\?\u0022<>\|\u0000-\u001F]/.test(b)?(d&&a.setMessage(a.t("%filename contains invalid characters.",e)),!1):!0};a.getFilterOptions=function(){var b,c=a.conf.filterOptions;c&&(b=typeof c.filterRE,"undefined"===b||"string"===b)&&(c.filterRE=
c.filterRegExps&&c.filterRegExps.length?new RegExp(c.filterRegExps.join("|")):!1);return c};a.appendDirItems=function(b,c,d){a.validateAppendDirItems(b,c,d)&&a.invoke("appendDirItems",b,c,d)};a.validateAppendDirItems=function(b,c,d){if(!c.appendItem||c.busy||c.readonly)return!1;var e,f,m,g;for(g in b){e=a.tree[g];if(!e||e.busy||!d&&e===c)return!1;m=b[g];for(f in m)if(e=m[f],!c.validateAppend(e,d)||!d&&e.isdir&&e.hasPredefinedPath())return!1}b=a.invoke("appendDirItemsValidate",b,c,d);return a.isIn(!0,
b)&&!a.isIn(!1,b)};a.groupItemsNames=function(b,c){var d,e,f,m,g,h,k={};a.isArray(b)&&(b=a.groupItemsByPath(b));for(d in b){m={};g=[];h=[];f=!1;for(e in b[d])f=b[d][e],f.isfile?g.push(f.name):h.push(f.name),c&&f.setBusy(!0);f&&(g.length&&(m.files=g),h.length&&(m.subdirs=h),k[d]=m)}return k};a.ajaxifyItems=function(b,c){var d,e,f={},m={},g=0,h=a.groupItemsNames(b,!c);for(d in h)e=h[d],m["dirnames["+g+"]"]=d,e.files&&(m["files["+g+"][]"]=e.files),e.subdirs&&(m["subdirs["+g+"][]"]=e.subdirs),g++;if(g)return f.data=
m,c||(f.busyNames=h),f};a.groupItemsByPath=function(b){var a,d,e,f={};for(e in b)a=b[e],a.parent&&(d=a.parent.path,f[d]&&f[d].push?f[d].push(a):f[d]=[a]);return f};a.getSelectedItems=function(){return a.activeDir.getSelectedItems()};a.permExists=function(b){var c,d,e,f=a.conf.dirConf;for(c in f)if((d=f[c])&&(e=d.perms)){do if(e[b]===q){if(e.all)return!0}else if(e[b])return!0;while((d=d.subdirConf)&&(e=d.perms))}return!1};a.setItemThumb=function(b){b.setThumb()};a.rootName=function(){return a.conf.rootName||
"<"+a.t("home")+">"};a.addDir=function(b){var c=a.tree[b];if(!c||!c.isdir){var d=b.split("/"),e=d.length-1,f="",m=a.tree["."];for(b=0;b<e;b++,f+="/")c=d[b],f+=c,a.tree[f]||m.appendItem(new a.Dir(c)),m=a.tree[f];m.appendItem(c=new a.Dir(d[b]))}return c};a.addTbi=function(b,c){return a.tbis[b]||new a.Tbi(b,c)};a.addCmi=function(b,c){if(a.els.CM)return a.cmis[b]||new a.Cmi(b,c);a._cmis[b]=c};a.createTemplateEl=function(b){var c=b+"TemplateEl",d=a.els;d[c]||(d[c]=a.htmlEl(a.template[b]));return d[c].cloneNode(!0)};
a.createLayer=function(b,c,d,e){var f,m=a.els;if(m[d])return m[d];f=a.createTemplateEl("layer");d&&(m[d]=f);f.id=b;e&&(f.className+=" "+e);!1!==c&&(c||l.body).appendChild(f);return f};a.createLoadingLayer=function(b,c){var d=a.createLayer(b,l.body,c);d.innerHTML='<span class="loading">'+a.t("Loading...")+"</span>";return d};a.createDataRowEl=function(b,c,d){var e=a.createTemplateEl("dataRow");b!==q&&(a.byClass("label",e)[0].innerHTML=b);c!==q&&(a.byClass("value",e)[0].innerHTML=c);d!==q&&(e.className+=
" "+d);return e};a.setUILoading=function(b){var c,d=a.els.UIOverlay;b?(d||(d=a.createLoadingLayer("dfm-ui-overlay","UIOverlay")),b=a.els.parent,c=a.absPos(b),a.showAt(d,{top:c.top+10,left:c.left+(b.offsetWidth-100)/2})):d&&(a.removeEl(d),delete a.els.UIOverlay)};a.setContentsLoading=function(b){var c,d=a.els.contentsOverlay;b?(d||(d=a.createLoadingLayer("dfm-contents-overlay","contentsOverlay")),b=a.els.contents,c=a.absPos(b),a.showAt(d,{top:c.top,left:c.left,width:b.offsetWidth,height:b.offsetHeight})):
d&&a.hideEl(d)};a.setPageOverlay=function(b,c,d){var e=l.documentElement,f=a.els.pageOverlay;b?(f||(f=a.createLayer("dfm-page-overlay",l.body,"pageOverlay"),f.onmousedown=a.ePageOverlayMousedown),a.showAt(f,{top:0,left:0,width:e.scrollWidth,height:e.scrollHeight})):f&&a.hideEl(f);f.closeCallback=c;f.closeData=d};a.ePageOverlayMousedown=function(b){this.closeCallback&&(b=a.eFix(b),this===b.target&&(this.closeCallback(this.closeData||b,b),b.preventDefault()))};a.historySave=function(){for(var b,c=a.history,
d=a.activeDir.getPath();c.states[c.current+1];)c.states.pop();b=c.states.length;b&&c.states[b-1]===d||(c.states[c.current=b]=d)};a.historyGo=function(b){var c,d=a.history;b=d.current+b;if(c=d.states[b])(c=a.tree[c])?(c.activate(!0),d.current=b):d.states.splice(b,1)};a.createTCMItemEl=function(b,c,d,e){if(!b.el){var f=b.el=a.createTemplateEl(d),m=b.tooltip||b.title||"";f.id=d+"-"+b.id;f.title=b.shortcut?a.t("!tooltip (!shortcut)",{"!tooltip":m,"!shortcut":b.shortcut}):m;f.onclick=a["e"+e+"Click"];
f[e]=b;b.titleEl=a.byClass(d+"-title",f)[0];b.title&&(b.titleEl.innerHTML=b.title);b.cname&&(f.className+=" "+b.cname);b.prepend&&c.firstChild?c.insertBefore(f,c.firstChild):c.appendChild(f)}};a.setTCMItemState=function(b,c,d){d?!b[c]&&a.setState(b,c,b.el):b[c]&&a.unsetState(b,c,b.el)};a.parseIframeResponse=function(b,c){var d,e,f;if((e=b.contentDocument||b.contentWindow&&b.contentWindow.document)&&(d=e.body)){if(e=d.getElementsByTagName("textarea")[0])f=a.parseTextResponse(e.value);c||(d.innerHTML=
"")}return f};a.parseTextResponse=function(b){if((b=b.replace(/^\s+|\s+$/g,""))&&!/^[^\{]|[^\}]$/.test(b))try{return p.eval("("+b+")")}catch(a){}};a.ajax=function(b,c){var d=a.activeDir,e={ajaxOp:b};c=a.extend(a.ajaxDefaults(),c);d&&d.path&&(e.activeDir=d.path);if(d=a.conf.securityKey)e.securityKey=d;c.dataObj=c.data=a.extend(e,c.data);return k.ajax(c)};a.ajaxDefaults=function(){return{url:a.conf.scriptUrl,type:"POST",dataType:"json",success:a.ajaxSuccess,error:a.ajaxError,complete:a.ajaxComplete}};
a.ajaxSuccess=function(b,c){this.response=b;a.responseRemoved(b);a.responseAdded(b);a.responseMessages(b);this.successCallback&&this.successCallback.apply(this,arguments)};a.ajaxComplete=function(b,c){this.busyNames&&a.busyComplete.apply(this,arguments);this.completeCallback&&this.completeCallback.apply(this,arguments);delete this.response};a.ajaxError=function(b,c,d){alert(a.ajaxErrorMessage(b,this.url))};a.loadSuccess=function(b,c){if(!b.activeDir||!b.dirConf||!b.dirContent)return a.loadSuccessUnexpected(b);
a.extend(a.conf,b);a.loadStyles(b.cssFiles);a.loadScripts(b.jsFiles,a.init)};a.loadSuccessUnexpected=function(b){if(b.messages){var c=a.setMessage;a.setMessage=function(b){alert(b)};a.responseMessages(b);a.setMessage=c}else alert("Invalid response from the server!")};a.loadComplete=function(b,c){a.loadingScripts||a.setUILoading(!1)};a.dirLoadSuccess=function(b,c){var d,e,f,m,g=a.tree;a.extend(a.conf.dirConf,b.dirConf);if(f=b.dirContent)for(d in f)(e=g[d])&&(m=f[d])&&e.setContent(m);a.responseMessages(b)};
a.dirLoadComplete=function(b,c){var d=this.dataObj.activeDir;if(d=d&&a.tree[d])d.setLoading(!1),d.expand()};a.busyComplete=function(){var b=this.busyNames,c=this.busyItemCallback;Array.prototype.splice.call(arguments,0);var d,e,f,m,g,h,k,l=["files","subdirs"];if(b)for(e in b)if(f=a.tree[e])if(d=b[e])for(k in l)if(m=d[l[k]])for(h in m)if(g=f.getItemByName(m[h]))g.setBusy(!1),c&&c.call(this,g,h,l[k],e)};a.responseAdded=function(b){var c,d,e,f,m,g,h=a.els.contents;if(m=b.added)for(c in m)if(g=m[c],g.files||
g.subdirs)if(b=a.addDir(c),b.addFiles(g.files),b.addSubdirs(g.subdirs),b.maySortItems(),b.sortTree(),b.active){b.deselectAllItems();if(g.files)for(e in g.files)b.getItemByName(e).select();if(g.subdirs)for(f in g.subdirs)b.getItemByName(f).select();(d=e||f)&&h.scrollHeight>h.clientHeight&&a.scrollToEl(b.getItemByName(d).itemEl,h);h.focus()}};a.responseRemoved=function(b){var c,d,e,f=a.tree;if(d=b.removed)for(c in d)(b=f[c])&&(e=d[c])&&(b.removeNames(e.files),b.removeNames(e.subdirs))};a.responseMessages=
function(b){var c,d;if(b=b.messages)for(d in b)for(c in b[d])a.setMessage(a.t.apply(a,b[d][c]),d)};a.ajaxErrorMessage=function(b,c){return a.t("An AJAX Error occured at !url.\nStatus Code: !status.\nStatus Text: !statusText.\nResponse Text: !responseText.",{"!url":c,"!status":b.status||0,"!statusText":b.statusText||"N/A","!responseText":b.responseText||"N/A"})};a.initCM=function(){var b=a.els.CM;if(!b){b=a.createLayer("dfm-cm",l.body,"CM");b.onmousedown=a.returnFalse;for(var c in a._cmis)a.addCmi(c,
a._cmis[c]);a.invoke("initCM")}return b};a.showCM=function(b){var c,d,e=a.initCM();for(c in a.cmis)d=a.cmis[c],d.stateCallback&&d.stateCallback.call(d,b)?d.enable():d.disable();a.invoke("showCM",b);e.opt=b;b.cname&&a.addClass(e,b.cname);a.showAt(e,{top:b.top,left:b.left},{fixPos:1});a.$doc.mousedown(a.eCMDocMousedown);return e};a.hideCM=function(){var b=a.els.CM;if(b){a.$doc.unbind("mousedown",a.eCMDocMousedown);a.hideEl(b);b.opt.cname&&a.removeClass(b,b.opt.cname);if(b.opt.onhide)b.opt.onhide(b.opt);
b.opt=null}};a.eCMDocMousedown=function(b){a.checkLineage(a.els.CM,b.target)||(a.hideCM(),b.preventDefault())};a.shortcuts.contents.k13=function(b){(b=a.activeDir.getLastSelectedItem())&&b.dblClick()};a.shortcuts.contents.k8=function(b){a.historyGo(b.shiftKey?1:-1)};a.shortcuts.contents.ctrl.k65=function(b){a.activeDir.selectAllItems()};a.shortcuts.contents.k39=a.shortcuts.contents.k37=function(b){if(b.altKey)return a.historyGo(b.keyCode-38);var c=a.activeDir,d=c.getLastSelectedItem(),e=0;d&&(e=c.getItemIndex(d)+
(b.keyCode-38));a.clickItemByIndex(e,b)};a.shortcuts.contents.k38=a.shortcuts.contents.k40=function(b){if(b.altKey)return 38==b.keyCode?a.eTbiUpClick(b):null;var c=a.activeDir,d=c.getLastSelectedItem(),e=0;d&&(e=c.getItemIndex(d)+a.elPerRow(d.itemEl)*(b.keyCode-39));a.clickItemByIndex(e,b)};a.eContentsMousedown=function(b){!a.preventContentsDrag&&a.activeDir.countItems()&&(b=a.eFix(b),a.updateElCoords(this),a.eOnScrollbar(b,this)||(a.bindDragDrop(a.eContentsDrag,a.eContentsDrop),b.preventDefault()));
a.preventContentsDrag=0;a.preventContentsClick=0;a.lte8?setTimeout(function(){a.els.contents.focus()}):this.focus()};a.eContentsTouchstart=function(b){this.focus()};a.eContentsDrag=function(b){var c=a.els.contents,d,e,f,m,g,h,k;a.eContentsDragInit(b);a.eDragAutoScroll(b,c,c.posTop,c.posRight,c.posBottom,c.posLeft);e=c.startX;m=c.startY;f=b.pageX+c.scrollLeft-c.posLeft;g=b.pageY+c.scrollTop-c.posTop;f<e&&(d=f,f=e,e=d);g<m&&(d=g,g=m,m=d);0>e&&(e=0);0>m&&(m=0);d=a.els.contentsSelection;h=(c.maxSL?c.scrollWidth:
c.clientWidth)-(d.offsetWidth-d.clientWidth)-1;k=(c.maxST?c.scrollHeight:c.clientHeight)-(d.offsetHeight-d.clientHeight)-1;f>h&&(f=h);g>k&&(g=k);f-=e;g-=m;a.setCss(d,{top:m,left:e,width:f,height:g},"px");e=c.posLeft+e-c.startSL;c=c.posTop+m-c.startST;a.activeDir.selectItemsByCoords(c,e+f,c+g,e,b.ctrlKey)};a.eContentsDragInit=function(b){if(!a.contentsDragging){a.contentsDragging=1;var c=a.els.contents,d=a.els.contentsSelection;c.startST=c.scrollTop;c.startSL=c.scrollLeft;a.setMaxSVals(c);c.startX=
b.pageX+c.scrollLeft-c.posLeft;c.startY=b.pageY+c.scrollTop-c.posTop;b.ctrlKey?a.activeDir.saveSelectionState():a.activeDir.deselectAllItems();a.activeDir.updateItemsCoords();d||(d=a.createLayer("dfm-contents-selection",c,"contentsSelection"));a.showEl(d)}};a.eContentsDrop=function(b){a.contentsDragging&&(a.preventContentsClick=1,a.hideEl(a.els.contentsSelection),a.contentsDragging=0,a.activeDir.saveSelectionState("reset"))};a.eContentsClick=function(b){a.preventContentsClick||(b=a.eFix(b),b.ctrlKey||
b.shiftKey||a.activeDir.deselectAllItems());a.preventContentsClick=0};a.eContentsContextmenu=function(b){b=a.eFix(b);a.activeDir.deselectAllItems();a.showCM({top:b.pageY,left:b.pageX,contentsCM:!0,target:a.activeDir,cname:"contents-cm"});b.preventDefault();b.stopPropagation()};a.eContentsMouseover=function(b){b=b||p.event;a.hoveringItem||a.hoveringDir||(a.hoveringDir=a.activeDir,a.eSetItemHoverDropState(a.activeDir,b.ctrlKey))};a.eContentsMouseout=function(b){b=b||p.event;b=b.relatedTarget||b.toElement;
a.hoveringItem||!a.hoveringDir||a.checkLineage(this,b,2)||(a.hoveringDir=null,a.setCursorDropState())};a.eContentsScroll=function(b){a.delayedUpdateActiveDirView();a.listViewing&&(a.updateListHead(),setTimeout(a.updateListHead))};a.eContentsKeydown=function(b){return a.eAreaShortcut("contents",b)};a.clickItemByIndex=function(b,c){var d=a.activeDir.getItemByIndex(b);d&&(d.click(c),a.scrollToEl(d.itemEl,a.els.contents))};a.byId=function(b){return l.getElementById(b)};a.byClass=function(b,a){a||(a=l);
return a.getElementsByClassName?a.getElementsByClassName(b):a.querySelectorAll?a.querySelectorAll("."+b):k("."+b,a).get()};a.classIndex=function(b,a){return b.className?(" "+b.className+" ").indexOf(" "+a+" "):-1};a.hasClass=function(b,c){return-1!==a.classIndex(b,c)};a.addClass=function(b,c){a.hasClass(b,c)||(b.className=b.className?b.className+" "+c:c)};a.removeClass=function(b,c){for(var d=a.classIndex,e=d(b,c);-1!=e;e=d(b,c))b.className=e?b.className.substr(0,e-1)+b.className.substr(e+c.length):
b.className.substr(c.length+1)};a.htmlEl=function(b){var c,d=a._div=a._div||l.createElement("div");d.innerHTML=b;(c=d.firstChild)&&d.removeChild(c);return c};a.removeEl=function(b){b.parentNode&&b.parentNode.removeChild(b)};a.showEl=function(b){b.style.display="block"};a.hideEl=function(b){b.style.display="none"};a.newEl=function(b){return l.createElement(b)};a.absPos=function(b){b=b.getBoundingClientRect();var c=a.winScroll();return{left:b.left+c.left,top:b.top+c.top}};a.winScroll=p.pageXOffset===
q?function(){return{left:l.documentElement.scrollLeft,top:l.documentElement.scrollTop}}:function(){return{left:p.pageXOffset,top:p.pageYOffset}};a.winSize=function(){return{width:p.innerWidth||l.documentElement.clientWidth,height:p.innerHeight||l.documentElement.clientHeight}};a.insertAfter=function(b,a){var d=a.nextSibling,e=a.parentNode;e&&(d?e.insertBefore(b,d):e.appendChild(b))};a.setCss=function(b,a,d){d===q&&(d="px");for(var e in a)b.style[e]=a[e]+d};a.checkLineage=function(b,a,d){for(d=d||
100;d&&a;d--,a=a.parentNode)if(a===b)return!0;return!1};a.eFix=function(b){return k.event.fix(b||p.event)};a.on=p.addEventListener?function(b,a,d){b.addEventListener(a,d,!1)}:p.attachEvent?function(b,a,d){b.attachEvent("on"+a,b[a+d]=function(){d.call(b,p.event)})}:function(){};a.off=p.removeEventListener?function(b,a,d){b.removeEventListener(a,d,!1)}:p.detachEvent?function(b,a,d){d=a+d;var e=b[d];e&&(b.detachEvent("on"+a,e),b[d]=null)}:function(){};a.setHtml=function(b,a){a&&a.nodeType?(b.innerHTML=
"",b.appendChild(a)):b.innerHTML=a||""};a.bindDragDrop=function(b,c,d){b=b&&b.drag?b:{drag:b,drop:c,isTouch:d};k(l).bind(b.isTouch?"touchmove":"mousemove",b,a.eDocDrag).bind(b.isTouch?"touchend":"mouseup",b,a.eDocDrop)};a.eDocDrag=function(b){var c=b.data;if(c.drag)return c.isTouch&&(b=a.eTouchFix(b,b.originalEvent.changedTouches[0])),b.preventDefault(),c.drag.call(this,b)};a.eDocDrop=function(b){var c,d=b.data;k(l).unbind(d.isTouch?"touchmove":"mousemove",a.eDocDrag).unbind(d.isTouch?"touchend":
"mouseup",a.eDocDrop);if(d.drop)return d.isTouch&&(c=b.originalEvent,b=a.eTouchFix(b,c&&c.changedTouches[0])),d.drop.call(this,b)};a.eTouchFix=function(b,a){b=k.event.fix(b);a&&a.pageX!==q&&(b.pageX=a.pageX,b.pageY=a.pageY,b.clientX=a.clientX,b.clientY=a.clientY);return b};a.eCommonTouchstart=function(b,c,d){var e,f=b.changedTouches;if(f&&(e=f[0])&&!f[1])return c&&c.call?c.call(d||this,a.eTouchFix(b,e),!0):!1};a.setCommonDown=function(b,c){b.CDHandler=c;a.on(b,"mousedown",a.eCDMousedown);a.on(b,"touchstart",
a.eCDTouchstart)};a.eCDMousedown=function(b){return this.CDHandler.call(this,a.eFix(b))};a.eCDTouchstart=function(b){return a.eCommonTouchstart(b,this.CDHandler,this)};a.setDragDrop=function(b,c,d,e){b.DDOpt=c&&c.drag?c:{drag:c,drop:d,down:e};a.setCommonDown(b,a.eDDCommonDown)};a.eDDCommonDown=function(b,c){var d=this.DDOpt;d.isTouch=c;d.down&&-1===d.down.apply(this,arguments)||(a.bindDragDrop(d),b.preventDefault())};a.initIntegration=function(){var b=a.urlParam(),c,d,e,f;if(a.extAppWin=f=p.opener||
p.parent)(d=b.fileHandler)&&(d=a.strToHandler(d,f))?a.setFileHandler(d):(e=b.urlFieldId)&&(a.extUrlField=f.document.getElementById(e))&&a.setFileHandler(a.extUrlHandler),(c=b.initHandler)&&(c=a.strToHandler(c,f))&&c(p),a.extFileHandler&&b.type&&(a.sendtoType=b.type)};a.setFileHandler=function(b,c,d){a.extFileHandler=b;return a.addTbi("sendto",{onclick:a.eSendtoClick,title:c||a.t("Select"),tooltip:d||a.t("Send the selected file to the external application")})};a.eSendtoClick=function(){a.runSendtoHandler()};
a.runSendtoHandler=function(b){var c,d,e,f=a.extFileHandler;if(f)for(c in b=b||a.getSelectedItems(),d="image"===a.sendtoType,b)if(e=b[c],d?e.isImageSource():e.isfile)return f(e,p)};a.extUrlHandler=function(b,c){try{var d=a.extAppWin;d.focus();(d.jQuery||k)(a.extUrlField).val(b.getUrl(a.urlParam().absurl)).blur().change().focus()}catch(e){}c.close()};a.strToHandler=function(b,a){var d,e=a||p,f=b.split("."),m=f.length;for(d=0;d<m&&(e=e[f[d]]);d++);return d==m&&e&&e.call&&e.apply?e:!1};a.loadScripts=
function(b,c){var d,e;e=Array.prototype.slice.call(arguments,2);b&&b.length?(d=b.concat([]),a.scripts||a.buildScriptList(),c&&c.apply&&(d.push(c),d.push(e)),(e=a.loadingScripts)?a.loadingScripts=e.concat(d):(a.loadingScripts=d,a.loadNextScript())):c&&c.apply(this,e)};a.buildScriptList=function(){var b,c,d=l.getElementsByName("script"),e=a.scripts={};for(b=0;c=d[b];b++)if(c=c.getAttribute("src"))e[c]=1};a.loadNextScript=function(){if(a.loadingScripts){if(!a.loadingScripts.length)return a.loadingScripts=
null;var b,c,d=a.loadingScripts.shift();if(d.apply)return d.apply(a,a.loadingScripts.shift()),a.loadNextScript();b=a.scripts[d];b===q?(a.scripts[d]=-1,c=a.extend(a.newEl("script"),a.scriptAttributes,{src:d}),(l.head||l.body).appendChild(c),a.scriptTimer=setTimeout(function(){a.scriptResult(c,0)},2E4)):-1<b&&a.loadNextScript()}};a.scriptAttributes={onload:function(){a.scriptResult(this,1)},onerror:function(){a.scriptResult(this,0)},onreadystatechange:function(){var b=this.readyState;"complete"!=b&&
"loaded"!=b||a.scriptResult(this,1)},type:"text/javascript",async:"async"};a.scriptResult=function(b,c){clearTimeout(a.scriptTimer);a.extend(b,{onload:null,onerror:null,onreadystatechange:null});a.scripts[b.getAttribute("src")]=c;a.loadNextScript()};a.loadStyles=function(b){if(b&&b.length){var c,d,e,f=a.styles=a.styles||{};for(c in b)(d=b[c])&&!f[d]&&(f[d]=1,e=a.extend(a.newEl("link"),{type:"text/css",rel:"stylesheet",media:"all",href:d}),(l.head||l.body).appendChild(e))}};a.setListView=function(b){b?
a.listViewing||(a.listViewing=1,a.createListHead(),a.activeDir&&a.activeDir.prepareListView(),a.addClass(l.body,"dfm-lw"),a.updateListHead(),a.updateSortBy()):a.listViewing&&(a.listViewing=0,a.removeClass(l.body,"dfm-lw"))};a.createListHead=function(){var b=a.els.listHead,c=a.els.contents,d;b||(b=a.els.listHead=a.htmlEl('<div id="dfm-list-head"><div class="item"><span class="item-date">'+a.t("Date")+'</span><span class="item-ext">'+a.t("Type")+'</span><span class="item-size">'+a.t("Size")+'</span><span class="item-icon"></span><span class="item-name">'+
a.t("Name")+"</span></div></div>"),b.onclick=a.eListHeadClick,(d=c.firstChild)?c.insertBefore(b,d):c.appendChild(b))};a.eListHeadClick=function(b){var c=a.eFix(b);b=a.activeDir;(c=(c=c.target.className)&&c.split("item-").pop().split(" ").shift())&&a.sorters[c]&&b.sortItems(c,c===b.sortKey?"desc"===b.sortDir?"asc":"desc":b.sortDir);a.preventContentsClick=1};a.updateListHead=function(){a.els.listHead.style.top=a.els.contents.scrollTop+"px"};a.mq=[];a.setMessage=function(b,c){c||(c="error");var d=a.mq,
e=d.length,f=b+":"+c;if(e&&d[e-1].msgId===f)return!1;d[e]=a.createMessageEl(b,c);d[e].msgId=f;a.pmqScheduled||(a.pmqScheduled=setTimeout(a.processMQ,250));return!1};a.processMQ=function(){var b=a.mq;b.length&&(k(a.createMessagePopupEl()).html(b).fadeIn(),b.length=0,a.$doc.bind("mousedown",a.eMPopDocMousedown),a.mPopCloseTimer=setTimeout(a.mPopClose,2500))};a.mPopClose=function(){if(a.mPopHovering)return a.mPopCloseTimerUp=1;clearTimeout(a.mPopCloseTimer);a.mPopCloseTimerUp=0;a.$doc.unbind("mousedown",
a.eMPopDocMousedown);k(a.els.messagePopup).fadeOut(500,a.processMQNext)};a.processMQNext=function(){a.pmqScheduled=0;a.mq.length&&(a.pmqScheduled=setTimeout(a.processMQ,250))};a.eMPopMouseenter=function(b){a.mPopHovering=1;a.mPopCloseTimerUp&&clearTimeout(a.mPopCloseTimer)};a.eMPopMouseleave=function(b){a.mPopHovering=0;a.mPopCloseTimerUp&&(a.mPopCloseTimer=setTimeout(a.mPopClose,2E3))};a.eMPopDocMousedown=function(b){a.mPopHovering||a.mPopClose()};a.createMessageEl=function(b,c){var d=a.htmlEl('<div class="message"><div class="m-icon"></div><div class="m-content"></div></div>');
d.className+=" "+c;d.children[1].innerHTML=b;return d};a.createMessagePopupEl=function(){var b=a.els.messagePopup;b||(b=a.createLayer("dfm-message-popup",a.els.main,"messagePopup"),k(b).hover(a.eMPopMouseenter,a.eMPopMouseleave));return b};a.urlParam=function(b){if(!a.urlParamList){var c,d,e,f=a.urlParamList={};if(location.search)for(c in e=location.search.substr(1).split("&"),e)d=e[c].split("="),f[a.uriDecode(d[0])]=d[1]?a.uriDecode(d[1]):""}return b===q?a.urlParamList:a.urlParamList[b]};a.t=function(b,
c){var d,e,f,m,g;b=a.i18n[b]||b||"";if(c)for(d in(m=a.i18nHandlers)||(m=a.i18nHandlers={"@":a.plain,"%":a.emplain}),c){e=c[d];f=d.split(":");f[1]&&(g=a[f[1]])&&(e=g(e));if(f=m[d.charAt(0)])e=f(e);b=b.replace(d,e)}return b};a.plain=function(b){return(""+b).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\x22/g,"&quot;")};a.emplain=function(b){return'<em class="plain">'+a.plain(b)+"</em>"};a.extend=function(b,a,d){var e;b=b||{};if(a)for(e in a)b[e]=a[e];if(d)for(e in d)b[e]=
d[e];return b};a.isArray=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)};a.inArray=function(b,c){for(var d in c)if(c[d]===b)return a.isArray(c)?1*d:d;return-1};a.isIn=function(b,c){return-1!==a.inArray(b,c)};a.uriDecode=function(b){try{return decodeURIComponent(b)}catch(a){}return b};a.cookie=function(b,c,d,e){if(c===q)return l.cookie?a.uriDecode((l.cookie.match(new RegExp("(?:^|;) *"+b+"=([^;]*)(?:;|$)"))||["",""])[1].replace(/\+/g,"%20")):"";null==d&&(d=7);
null==e&&(e=location.pathname);p.ActiveXObject&&"/"!==e.charAt(e.length-1)&&(e="/");b=b+"="+encodeURIComponent(c);d&&(b+="; expires="+(new Date(1*new Date+864E5*d)).toUTCString());l.cookie=b+("; path="+e)};a.formatDate=function(b,c){var d,e,f="";b&&(d=new Date(1E3*b),e=a.prependZero,f=d.getFullYear()+"-"+e(d.getMonth()+1)+"-"+e(d.getDate()),c||(f+=" "+e(d.getHours())+":"+e(d.getMinutes())));return f};a.prependZero=function(b){return 10>b?"0"+b:b};a.formatSize=function(b){return b===q?"":!b||1024>
b?a.t("!size bytes",{"!size":b||0}):1048576>b?a.t("!size KB",{"!size":a.round(b/1024,1)}):a.t("!size MB",{"!size":a.round(b/1048576,1)})};a.round=function(b,a){var d=Math.pow(10,a);return Math.round(b*d)/d};a.innerText=function(b){return(""+b).replace(/&/g,"&amp;").replace(/</g,"&lt;")};a.int=function(b){return parseInt(b)||0};a.registerHook("previewItem","main",function(b){var c,d,e;b.isImageSource()&&(d=a.byClass("item-link",a.els.itemPreview)[0])&&(e=a.newEl("span"),e.className="prv-widget",c=
e.title=d.href,e.Url=c+(-1==c.indexOf("?")?"?":"&")+("s"+b.size)+("d"+b.date),e.onclick=a.ePrvWidgetClick,a.insertAfter(e,d),a.prvWidgetClosed||k(e).click())});a.delayedUpdatePreview=function(){clearTimeout(a.updatePreviewTimer);a.updatePreviewTimer=setTimeout(a.updatePreview,100)};a.updatePreview=function(){var b=a.activeDir;a.previewItem(1==b.countSelectedItems()?b.getLastSelectedItem():null)};a.previewItem=function(b){var c=a.els.itemPreview,d=a.previewingItem;(a.previewingItem=b)?(k(c).html(b.previewContent()),
a.invoke("previewItem",b)):d&&(c.innerHTML="")};a.ePrvWidgetClick=function(b){this.Img||(this.Img=a.newEl("img"),this.Img.src=this.Url,this.Url=null);a.hasClass(this,"expanded")?(this.removeChild(this.Img),a.removeClass(this,"expanded"),a.prvWidgetClosed=1):(this.appendChild(this.Img),a.addClass(this,"expanded"),a.prvWidgetClosed=0);return!1};a.eTreeResizerDrag=function(b){var c=a.els.treeResizer;a.els.tree.style.width=Math.min(Math.max(c.startW+b.pageX-c.startX,0),c.maxW)+"px"};a.ePreviewResizerDrag=
function(b){var c=a.els.previewResizer;a.els.preview.style.width=Math.min(Math.max(c.startW+c.startX-b.pageX,0),c.maxW)+"px"};a.eResizerDown=function(b){var c=a.els;this.startX=b.pageX;this.startW=k(this===c.treeResizer?c.tree:c.preview).width();this.maxW=this.startW+k(c.contents).width()};a.sortText=function(b,a){return b.toLowerCase()<a.toLowerCase()?-1:1};a.sortNumber=function(b,a){return b-a};a.sortBranchName=function(b,c){return a.sortText(b.name,c.name)};a.sortItemName=function(b,c){return b.isdir===
c.isdir?a.sortText(b.name,c.name):b.isdir?-1:1};a.sortItemDate=function(b,c){return b.isdir===c.isdir?a.sortNumber(b.date||0,c.date||0):b.isdir?-1:1};a.sortItemSize=function(b,c){return b.isdir===c.isdir?b.isdir?0:a.sortNumber(b.size||0,c.size||0):b.isdir?-1:1};a.sortItemExt=function(b,c){return b.isdir===c.isdir?b.isdir?0:a.sortText(b.ext||"",c.ext||""):b.isdir?-1:1};a.initSortBy=function(){if(!a.els.sortBy){var b,c=a.sorters,d=a.els.sortBy=a.tbis.sortby.content=a.htmlEl('<div id="dfm-sortby"></div>');
d.onmousedown=a.returnFalse;for(b in c)d.appendChild(a.createSorterEl(b,c[b]));d.appendChild(a.createSortDirectionEl("asc",a.t("Ascending")));d.appendChild(a.createSortDirectionEl("desc",a.t("Descending")))}};a.createSorterEl=function(b,c){var d=a.createTemplateEl("sorter");d.className+=" "+b;d.onclick=a.eSorterClick;d.sorterKey=b;d.title=a.byClass("sorter-title",d)[0].innerHTML=c.title;return c.el=d};a.createSortDirectionEl=function(b,c){var d=a.createSorterEl(b,{title:c});d.className+=" direction";
d.onclick=a.eSortDirectionClick;return a.els[b+"DirectionEl"]=d};a.eSorterClick=function(b){b=a.activeDir;var c=this.sorterKey;c!==b.sortKey&&b.sortItems(c)};a.eSortDirectionClick=function(b){b=a.activeDir;var c=this.sorterKey;b.sortDir!==c&&b.sortItems(b.sortKey,c)};a.updateSortBy=function(){var b,c,d,e,f,m,g=a.activeDir;if(g&&(f=g.sortKey)&&(m=g.sortDir)){if((e=a.els.sortBy)&&a.tbis.sortby.popupOn)for(b=0,d=["sortKey","sortDir"];c=d[b];b++)e[c]!==g[c]&&(e[c]&&a.removeClass(a.byClass(e[c],e)[0],
"active"),a.addClass(a.byClass(e[c]=g[c],e)[0],"active"));a.listViewing&&(e=a.els.listHead)&&(e.sortKey!==f||e.sortDir!==m)&&(e.sortKey&&a.removeClass(a.byClass("item-"+e.sortKey,e)[0],e.sortDir),a.addClass(a.byClass("item-"+(e.sortKey=f),e)[0],e.sortDir=m))}};a.template.sorter='<div class="sorter"><span class="sorter-icon"></span><span class="sorter-title"></span></div>';a.shortcuts.tree.k13=function(b){a.activeDir.open()};a.shortcuts.tree.k8=function(b){a.historyGo(b.shiftKey?1:-1)};a.shortcuts.tree.k38=
function(b){if(b.altKey)return a.eTbiUpClick(b);var c=a.activeDir;if(b=c.branchEl.previousSibling){if(c=b.Dir)for(;c.expanded;)if(b=c.subtreeEl.lastChild)c=b.Dir}else c=c.parent;a.focusOnBranch(c)};a.shortcuts.tree.k40=function(b){b=a.activeDir;var c,d;if(b.expanded&&(c=b.subtreeEl.firstChild))d=c.Dir;else{do if(c=b.branchEl.nextSibling){d=c.Dir;break}while(b=b.parent)}a.focusOnBranch(d)};a.shortcuts.tree.k37=a.shortcuts.tree.k39=function(b){if(b.altKey)return a.historyGo(b.keyCode-38);var c=a.activeDir;
39==b.keyCode^c.expanded&&k(c.branchControlEl).click()};a.focusOnBranch=function(b){b&&(b.activate(),a.scrollToEl(b.branchHeadEl,a.els.tree))};a.eTreeMousedown=function(b){a.lte8?setTimeout(function(){a.els.tree.focus()}):this.focus()};a.eTreeTouchstart=function(b){this.focus()};a.eTreeKeydown=function(b){return a.eAreaShortcut("tree",b)};a.setUploadZone=function(b,c){k(b).bind("dragenter",c,a.eUploadZoneDragenter).bind("dragleave",c,a.eUploadZoneDragleave).bind("dragover",c,a.eUploadZoneDragover).bind("drop",
c,a.eUploadZoneDrop)};a.eUploadZoneDragenter=function(b){this.uzHoverEl=b.target;if(this.uzHover||a.eUploadZoneHasFiles(b))return this.uzHover||b.data.dragenter&&!1===b.data.dragenter.call(this,b)||(this.uzHover=1,b.data.toggleClass&&k(this).addClass(b.data.toggleClass)),!1};a.eUploadZoneDragleave=function(b){if(this.uzHover)return this.uzHoverEl!==b.target||b.relatedTarget&&b.target===b.relatedTarget||(b.data.dragleave&&b.data.dragleave.call(this,b),a.eUploadZoneRestore(b,this)),!1};a.eUploadZoneDrop=
function(b){var c,d;if(this.uzHover)return b.data.drop&&(d=(c=b.originalEvent.dataTransfer)&&c.files,b.data.drop.call(this,b,c,d&&d.length?d:null)),a.eUploadZoneRestore(b,this),!1};a.eUploadZoneDragover=function(b){if(this.uzHover)return!1};a.eUploadZoneHasFiles=function(b){var a,d;if((b=(b.originalEvent||b).dataTransfer)&&(a=b.types)&&(d=a.length))for(b=0;b<d;b++)if("Files"===a[b])return!0;return!1};a.eUploadZoneRestore=function(b,a){a.uzHover=0;a.uzHoverEl=null;b.data.toggleClass&&k(a).removeClass(b.data.toggleClass)};
var t=a.Flash={};t.getVersion=function(b){if(!t.version){var a,d,e,f,g=[];if(p.ActiveXObject)try{f=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version").split(/\D+/)}catch(h){}!f&&(a=navigator.mimeTypes)&&(a=a["application/x-shockwave-flash"])&&(d=a.enabledPlugin)&&(e=d.description)&&(f=e.split(/\D+/));if(f)for(a=0;a<f.length;a++)f[a].length&&g.push(1*f[a]);t.version=g.length?g:[0,0,0]}return b?t.version:t.version[0]};t.createHtml=function(a,c,d){var e;c=c||{};d=d||{};var f=
"",g="";c.type="application/x-shockwave-flash";p.ActiveXObject?(c.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",d.movie=a):c.data=a;for(e in c)f+=" "+e+'="'+c[e]+'"';for(e in d)g+='<param name="'+e+'" value="'+d[e]+'" />';return"<object"+f+">"+g+"</object>"};a.Cmi=function(b,c){a.cmis[b]=this;this.id=b;a.extend(this,c);a.createTCMItemEl(this,a.els.CM,"cmi","Cmi")};var g=a.Cmi.prototype;g.enable=function(){a.setTCMItemState(this,"disabled",!1)};g.disable=function(){a.setTCMItemState(this,"disabled",
!0)};a.eCmiClick=function(b){var c=this.Cmi,d;!c.onclick||c.disabled||c.working||(d=a.els.CM.opt,a.hideCM(),c.onclick.call(this,a.eFix(b),d))};a.template.cmi='<div class="cmi"><span class="cmi-icon"></span><span class="cmi-title"></span></div>';a.Tbi=function(b,c){a.tbis[b]=this;this.id=b;a.extend(this,c);a.createTCMItemEl(this,a.els.toolbar,"tbi","Tbi")};g=a.Tbi.prototype;g.openPopup=function(b,c){var d;this.popupOn||(this.createPopup(),this.popupOn=!0,a.addClass(this.el,"active"),d=a.absPos(this.el),
d.top+=k(this.el).outerHeight(!0),a.showAt(this.popup,d,{fixPos:1,effect:b}),c&&a.$doc.bind("mousedown",{Tbi:this},a.eTbiDocMousedown),this.onopen&&this.onopen.apply(this,arguments))};g.createPopup=function(){this.popup||(this.popup=a.createLayer("dfm-"+this.id+"-tbi-popup",l.body,this.id+"TbiPopup","tbi-popup"),this.content&&this.popup.appendChild(this.content));return this.popup};g.closePopup=function(b){this.popup&&this.popupOn&&(a.removeClass(this.el,"active"),k(this.popup)[b||"hide"](),this.popupOn=
!1,this.onclose&&this.onclose.apply(this,arguments))};g.setWorking=function(b){a.setTCMItemState(this,"working",b)};g.setDisabled=function(b){a.setTCMItemState(this,"disabled",b)};g.click=function(b){this.disabled||(this.onclick&&!this.working&&this.onclick.call(this,a.eFix(b)),this.content&&this.openPopup("fadeIn",!0))};a.eTbiClick=function(a){this.Tbi.click(a)};a.eTbiDocMousedown=function(b){var c=b.data.Tbi;a.checkLineage(c.popup,b.target)||(c.closePopup(),a.$doc.unbind("mousedown",a.eTbiDocMousedown))};
a.eToolbarMousedown=function(b){var c=a.eFix(b).target,d=c.Tbi||c.parentNode.Tbi;d&&(a.addClass(d.el,"down"),a.$doc.one("mouseup",function(b){a.removeClass(d.el,"down");c=d=null}));return!1};a.template.tbi='<span class="tbi"><span class="tbi-icon"></span><span class="tbi-title"></span></span>';a.Queue=function(a){this.construct(a)};g=a.Queue.prototype;g.construct=function(a){a&&(this.queue=[],this.conf=a)};g.start=function(){!this.isOn&&this.queue.length&&this.next()&&(this.isOn=!0,this.callEvent("QueueStart"));
return this.isOn};g.end=function(){this.isOn&&(this.isOn=!1,this.activeItem&&this.removeItem(this.activeItem),this.callEvent("QueueEnd"))};g.next=function(){if(this.activeItem)return this.activeItem;for(var a,c=0;a=this.queue[c];c++)if(this.startItem(a))return a;this.end()};g.addItem=function(a){this.queue.push(a);return a};g.removeItem=function(a){var c=this.queue,d=k.inArray(a,c);if(-1!=d)return c.splice(d,1),this.stopItem(a),this.callEvent("ItemRemove",{item:a}),a};g.startItem=function(a){if(!a.started&&
!1!==this.callEvent("ItemStart",{item:a}))return a.started=new Date,this.activeItem=a};g.stopItem=function(a){if(a===this.activeItem&&!1!==this.callEvent("ItemStop",{item:a}))return this.activeItem=null,this.isOn&&this.next(),a};g.progressItem=function(a,c,d){if(!1!==this.callEvent("ItemProgress",{item:a,loaded:c,total:d}))return a};g.completeItem=function(a,c){if(!1!==this.callEvent("ItemComplete",{item:a,data:c}))return this.removeItem(a)};g.errorItem=function(a,c,d){if(!1!==this.callEvent("ItemError",
{item:a,errorType:c,message:d}))return this.removeItem(a)};g.callEvent=function(a,c){var d=this.conf["on"+a];if(d)return c||(c={}),c.type===q&&(c.type=a),d.call(this,c)};g.getItemConf=function(a){var c=this.conf,d=k.extend({},c,a),e=d.form?k(d.form).serializeArray():[];d.data=e.concat(c.data||[],a.data||[]);return d};g.getConf=function(a){return this.conf[a]};var r=a.Upq=function(a){this.construct(a)};r.instances=[];g=r.prototype=new a.Queue;g.construct=function(b){a.Queue.prototype.construct.apply(this,
arguments);b&&(this.conf=a.extend({buttonText:"Add file"},b),this.index=r.instances.length,r.instances[this.index]=this,this.items={},this.createEl())};g.createEl=function(){var b,c,d=this.conf;this.wrpEl||(b=this.wrpEl=a.htmlEl('<div class="dfm-upq"><div class="dfm-upq-button"><div class="text"></div></div><div class="dfm-upq-queue"></div></div>'),c=this.buttonEl=b.children[0],this.textEl=c.children[0],this.textEl.innerHTML=d.buttonText,this.queueEl=b.children[1],d.wrpEl&&(k(d.wrpEl).append(b.children),
d.wrpEl.className+=" "+b.className,this.wrpEl=d.wrpEl),this.callEvent("DomInit"))};g.createItem=function(b,c){var d,e,f,g;if(b&&(c||(c={}),c.dir||(c.dir="."),f=b.name,e=c.fid||c.dir+"/"+f,!this.activeItem||this.activeItem.fid!==e))return(g=this.items[e])&&this.removeItem(g,!0),d=this.queue.length,g=this.items[e]=this.queue[d]=a.extend({},c,{fid:e,Upq:this,file:b}),e=g.el=a.htmlEl('<div class="queue-item"><div class="qi-remove"><span>x</span></div><div class="qi-info"><span class="qi-name"></span> <span class="qi-size"></span> <span class="qi-stat"></span></div><div class="qi-progress"><div class="qi-bar"></div></div></div>'),
e.className+=" qi-"+d,d=g.nameEl=a.byClass("qi-name",e)[0],d.innerHTML=a.plain(f),d.title=f,g.sizeEl=a.byClass("qi-size",e)[0],g.sizeEl.innerHTML=a.formatSize(b.size),g.statEl=a.byClass("qi-stat",e)[0],g.statEl.innerHTML=a.t("!percent%",{"!percent":0}),g.barEl=a.byClass("qi-bar",e)[0],f=g.removeEl=a.byClass("qi-remove",e)[0],f.qItem=g,f.onclick=r.eItemRemoveClick,f.onmousedown=r.eItemRemoveMousedown,this.queueEl.appendChild(e),g};g.removeItem=function(b,c){if(b=a.Queue.prototype.removeItem.apply(this,
arguments))return delete this.items[b.fid],c?k(b.el).remove():k(b.el).fadeOut(1E3,r.eItemRemoveComplete),b};g.selectFiles=function(a){var c,d,e,f=this.callEvent("ListSelect",{list:a});if(f)for(c in f)if(d=this.createItem(a[c],f[c]))e||(e={}),e[c]=d.fid;return e};g.fileProgress=function(b,c,d){(b=this.items[b])&&this.progressItem(b,c,d)&&(c=a.int(100*c/d),b.statEl.innerHTML=a.t("!percent%",{"!percent":c}),b.barEl.style.width=c+"%")};g.fileComplete=function(b,c){var d=this.items[b];d&&this.completeItem(d,
c)&&(d.statEl.innerHTML=a.t("Complete"))};g.fileError=function(a,c,d){(a=this.items[a])&&this.errorItem(a,c,d)};r.callInstance=function(a,c,d){if(c=(a=r.instances[a])&&a[c])return c.apply(a,d||[])};r.eItemRemoveClick=function(a){(a=this.qItem)&&a.Upq&&a.Upq.removeItem(a,!0);return!1};r.eItemRemoveMousedown=function(){return!1};r.eItemRemoveComplete=function(){k(this).remove()};a.Item=function(a,c){this.construct(a,c)};var n=a.Item.prototype;n.construct=function(a,c){a!==q&&(this.createElements(),
this.setName(a),this.extend(c))};n.createElements=function(){var b;this.itemEl||(b=this.itemEl=a.createTemplateEl("item"),b.onclick=a.eItemClick,b.onmousedown=a.eItemMousedown,b.ondblclick=a.eItemDblClick,b.oncontextmenu=a.eItemContextmenu,b.onmouseover=a.eItemMouseover,b.onmouseout=a.eItemMouseout,b.ontouchstart=a.eItemTouchstart,b.ontouchend=a.eItemTouchend,b.Item=this,this.itemNameEl=a.byClass("item-name",b)[0],this.itemIconEl=a.byClass("item-icon",b)[0])};n.appendTo=function(a){a.appendItem(this)};
n.remove=function(){this.parent&&this.parent.removeItem(this)};n.click=function(a){var c=this.container;if(a){if(a.shiftKey)return this.shiftClick();if(a.ctrlKey)return this.ctrlClick()}!c||this.selected&&1==c.countSelectedItems()||(c.deselectAllItems(),this.select())};n.shiftClick=function(){var a,c,d,e=this.container;if(e)for(c=(a=e.getLastSelectedItem())?e.getItemIndex(a):-1,d=e.getItemIndex(this),a=c<d?1:-1;c!=d;)e.getItemByIndex(c+=a).select()};n.ctrlClick=function(){this.toggleSelect()};n.dblClick=
function(){a.extFileHandler?a.runSendtoHandler([this]):this.open()};n.open=function(){var a=this.getUrl();a&&p.open(a)};n.select=function(a){!this.selected&&this.container&&(this.setState("selected",this.itemEl),this.container.setSelectedItem(this,a))};n.deselect=function(a){this.selected&&(this.unsetState("selected",this.itemEl),this.container&&this.container.unsetSelectedItem(this,a))};n.toggleSelect=function(){this.selected?this.deselect():this.select()};n.setBusy=function(a){a?this.busy||(this.setState("busy",
this.itemEl,this.branchHeadEl),this.setIconOverlay(!0),this.parent&&this.parent.setBusyItem(this)):this.busy&&(this.unsetState("busy",this.itemEl,this.branchHeadEl),this.setIconOverlay(!1),this.parent&&this.parent.unsetBusyItem(this))};n.setIconOverlay=function(b){b?(this.iconOverlayEl||(this.iconOverlayEl=a.htmlEl('<span class="icon-overlay"></span>')),this.itemIconEl.appendChild(this.iconOverlayEl)):this.iconOverlayEl&&a.removeEl(this.iconOverlayEl)};n.isInsideCoords=function(a,c,d,e){return this.itemEl.posLeft<
c&&this.itemEl.posRight>e&&this.itemEl.posTop<d&&this.itemEl.posBottom>a};n.isOperable=function(){return!this.busy};n.getPath=function(){return this.path?this.path:this.parent?a.joinPaths(this.parent.getPath(),this.name):this.name};n.getFullPath=function(){return a.joinPaths(a.conf.rootDirPath||"/",this.getPath())};n.getUrlPath=function(a){var c=encodeURIComponent(this.getPath()).replace(/%2F/g,"/");return a?c.replace(/%(23|26)/g,"%25$1"):c};n.getUrl=function(b,c){var d,e="";if(d=a.conf.rootDirUrl)e=
a.joinPaths(d,this.getUrlPath(a.conf.urlRewrite)),b&&"/"===e.charAt(0)&&"/"!==e.charAt(1)&&(e=location.protocol+"//"+location.host+e),c&&(e+=(-1==e.indexOf("?")?"?":"&")+("s"+this.size)+("d"+this.date));return e};n.getThumbUrl=function(){if(this.width){var b;b=a.conf;var c=b.thumbUrl;if(c){c=a.joinPaths(c,this.getUrlPath(b.thumbUrlRewrite));if(b=b.thumbUrlQuery)c+=(-1===c.indexOf("?")?"?":"&")+b;return c}}return""};n.formatFullPath=function(){return a.plain(this.getFullPath())};n.formatPath=function(){return a.plain("."===
this.path?this.name:this.getPath())};n.formatName=function(){return a.plain(this.name)};n.formatSize=function(){return a.formatSize(this.size)};n.formatDate=function(b){return a.formatDate(this.date,b)};n.formatType=function(){return a.t("Item")};n.formatDimensions=function(){return this.width?this.width+"x"+this.height:""};n.extend=function(a){if(a){this.viewUpdated=0;for(var c in a)this.setProp(c,a[c])}};n.setProp=function(a,c){var d=this[a];d!==c&&(this[a]=c,this.triggerPropChange(a,d))};n.setName=
function(a){this.setProp("name",a)};n.triggerPropChange=function(a,c){var d=a+"OnChange";if(this[d])this[d](c)};n.nameOnChange=function(b){var c=this.parent;this.itemNameEl.innerHTML=this.formatName();this===a.previewingItem&&(this.deselect(),this.select());c&&c.itemNameOnChange(this,b)};n.sizeOnChange=function(a){var c=this.parent;this.itemSizeEl&&(this.itemSizeEl.innerHTML=this.formatSize());c&&(c.itemSizeOnChange(this,a),c!==this.container&&this.container.itemSizeOnChange(this,a))};n.dateOnChange=
function(a){this.itemDateEl&&(this.itemDateEl.innerHTML=this.formatDate(!0))};n.hoverPopupContent=function(){var b=[],c=this.parent;b[0]=a.createDataRowEl(a.t("Name"),this.formatName(),"name");b[1]=a.createDataRowEl(a.t("Type"),this.formatType(),"type");this.size!==q&&b.push(a.createDataRowEl(a.t("Size"),this.formatSize(),"size"));this.date!==q&&b.push(a.createDataRowEl(a.t("Date"),this.formatDate(),"date"));this.width&&b.push(a.createDataRowEl(a.t("Dimensions"),this.formatDimensions(),"dimensions"));
c&&c!==this.container&&b.push(a.createDataRowEl(a.t("Folder"),c.formatPath(),"parentdir"));return b};n.previewContent=function(){var b,c=this.hoverPopupContent(),d=this.parent,e;d&&d!==n.container&&(e=c[c.length-1],a.hasClass(e,"parentdir")&&(e=a.byClass("value",e)[0])&&(e.innerHTML='<a class="item-parent-link" href="#">'+d.formatPath()+"</a>",e.firstChild.dirPath=d.getPath(),e.firstChild.onclick=a.eItemParentLinkClick));(b=this.getUrl(!0))&&c.push(a.createDataRowEl(a.t("URL"),'<a class="item-link" href="'+
b+'" target="_blank">'+b+"</a>","url"));return c};n.processListView=function(){var b,c,d;this.listViewProcessed||(this.listViewProcessed=1,d=this.itemEl,c=d.firstChild,b=this.itemDateEl=a.newEl("span"),b.className="item-date",b.innerHTML=this.formatDate(!0),d.insertBefore(b,c),b=this.itemExtEl=a.newEl("span"),b.className="item-ext",b.innerHTML=this.formatType(),d.insertBefore(b,c),b=this.itemSizeEl=a.newEl("span"),b.className="item-size",b.innerHTML=this.formatSize(),d.insertBefore(b,c))};n.setState=
function(b,c,d){a.setState(this,b,c,d)};n.unsetState=function(b,c,d){a.unsetState(this,b,c,d)};n.setThumb=function(a){var c;a===q&&(a=this.getThumbUrl());a&&(c=this.itemIconEl,c.style.backgroundImage='url("'+a+'")',c.className+=" thumb")};n.groupSelf=function(){var a={},c;this.parent&&(c=this.parent.path)&&(a[c]=[this]);return a};n.setContainer=function(b){b?b.contentEl.appendChild(this.itemEl):a.removeEl(this.itemEl);this.container=b};n.restoreContainer=function(){var a=this.parent;a&&(this.setContainer(a),
a.needDomSort=1)};n.isImageSource=function(){return this.width||this.ext&&"svg"===this.ext.toLowerCase()};a.template.item='<div class="item"><span class="item-icon"></span><span class="item-name"></span></div>';a.eItemMousedown=function(b){b=a.eFix(b);return this.preventMousedown?(this.preventMousedown=0,b.stopPropagation(),!1):a.eItemDown.call(this,b)};a.eItemTouchstart=function(b){this.preventMousedown=1;a.setTaphold(this,a.eItemTaphold);return a.eCommonTouchstart(b,a.eItemDown,this)};a.eItemTaphold=
function(){this.Item.ctrlClick();this.preventClick=this.preventContextmenu=1;this.Item.selected?a.bindDragDrop(a.eItemDrag,a.eItemDrop,!0):k(l).triggerHandler("touchend")};a.eItemTouchend=function(a){a=this.lastTouchendTime;var c=(new Date).getTime();this.lastTouchendTime=c;a&&500>c-a&&this.Item.dblClick()};a.eItemDown=function(b,c){var d=this.Item;this.preventClick=0;d.selected||b.target===this||c||(this.preventClick=1,d.click(b));if(d.selected&&(a.bindDragDrop(a.eItemDrag,a.eItemDrop,c),a.preventContentsDrag=
1,!c))return!1};a.eItemDrag=function(b){return a.eCommonItemDrag(b)};a.eCommonItemDrag=function(b){var c=b.data.isTouch;a.eItemDragInit(b);a.eInnerDragAutoScroll(b,a.els.contents)||a.eInnerDragAutoScroll(b,a.els.tree);a.els.cursorPopup.style.left=b.pageX+(c?20:5)+"px";a.els.cursorPopup.style.top=b.pageY+(c?-35:-15)+"px";if(c){var c=l.elementFromPoint(b.clientX,b.clientY),d=a.getObjFromEl(c,"item","Item"),e;d||(e=a.getObjFromEl(c,"branch-head","Dir"));a.setHoveringItem(d,!0,b);a.setHoveringDir(e,!0,
b)}};a.eItemDragInit=function(b){a.itemDragging||(a.itemDragging=1,a.createLayer("dfm-cursor-popup",l.body,"cursorPopup"),a.addClass(l.body,"dfm-dragging"),p.ActiveXObject&&(l.body.style.cursor="move"),a.prepareForInnerDragAutoScroll(a.els.contents,32,32),a.prepareForInnerDragAutoScroll(a.els.tree,20,20))};a.eItemDrop=function(b){if(a.itemDragging){a.itemDragging=0;a.removeClass(l.body,"dfm-dragging");p.ActiveXObject&&(l.body.style.cursor="auto");a.preventContentsClick=1;var c=a.hoveringItem||a.hoveringDir;
c&&!c.selected&&a.appendDirItems(a.activeDir.groupSelectedItems(),c,b.ctrlKey);b.data.isTouch&&(a.setHoveringItem(null,!0),a.setHoveringDir(null,!0))}};a.eItemClick=function(b){b=a.eFix(b);var c=this.Item;this.preventClick||c.click(b);a.preventContentsClick=1;b.preventDefault()};a.eItemDblClick=function(a){this.Item.dblClick();return!1};a.eItemContextmenu=function(b){b=a.eFix(b);var c=this.Item;this.preventContextmenu||(c.selected||c.click(),a.showCM({top:b.pageY,left:b.pageX,itemCM:!0,Item:c,target:c,
cname:"item-cm"}));this.preventContextmenu=0;b.preventDefault();b.stopPropagation()};a.eItemMouseover=function(b){this.preventMousedown||(b=b||p.event,a.checkLineage(this,b.relatedTarget||b.fromElement,3)||a.setHoveringItem(this.Item,a.itemDragging&&k.browser.safari,a.eFix(b)))};a.eItemMouseout=function(b){b=b||p.event;a.checkLineage(this,b.relatedTarget||b.toElement,3)||a.setHoveringItem(null,k.browser.safari)};a.eItemParentLinkClick=function(b){(b=a.tree[this.dirPath])&&b.open();return!1};a.setHoveringItem=
function(b,c,d){a.hoveringItem!=b&&(a.hoveringItem&&(clearTimeout(a.itemHoverPopupTimer),a.els.itemHoverPopup&&a.hideEl(a.els.itemHoverPopup),a.setCursorDropState(),c&&a.removeClass(a.hoveringItem.itemEl,"draghover"),a.hoveringItem=null),b&&d&&(a.hoveringItem=b,a.eMposUpdate(d),a.itemHoverPopupTimer=setTimeout(a.showItemHoverPopup,1E3),a.eSetItemHoverDropState(b,d.ctrlKey),c&&a.addClass(b.itemEl,"draghover")))};a.showItemHoverPopup=function(){var b,c;b=a.hoveringItem;var d=a.els.CM;!b||!b.parent||
d&&d.offsetWidth||!(c=b.hoverPopupContent())||(b=a.createLayer("dfm-item-hover-popup",l.body,"itemHoverPopup"),k(b).html(c),a.showAt(b,{left:a.mpos.left+10,top:a.mpos.top+10},{fixPos:1,shiftTop:20}))};a.setTaphold=function(a,c,d,e){var f=setTimeout(function(){c.apply(a,d||[]);g()},e||350),g=function(){clearTimeout(f);k(a).unbind("touchmove",g).unbind("touchend",g);a=d=null};k(a).bind("touchmove",g).bind("touchend",g)};a.File=function(a,c){this.construct(a,c)};g=a.File.prototype=new a.Item;g.ancestor=
a.Item.prototype;g.construct=function(a,c){this.isfile=!0;this.type="file";this.ancestor.construct.apply(this,arguments)};g.createElements=function(){this.itemEl||(this.ancestor.createElements.apply(this,arguments),this.itemEl.className+=" file")};g.nameOnChange=function(b){this.ancestor.nameOnChange.apply(this,arguments);var c=this.name.lastIndexOf("."),c=-1==c?"":this.name.substr(c+1);this.ext!==c&&(this.ext!==q&&a.removeClass(this.itemEl,this.ext?"ext-"+this.ext.toLowerCase():"no-ext"),this.itemEl.className+=
c?" ext-"+c.toLowerCase():" no-ext",this.ext=c,this.itemExtEl&&(this.itemExtEl.innerHTML=this.formatType()))};g.formatType=function(){return this.ext?a.plain(this.ext.toUpperCase()):"-"};a.Dir=function(a,c){this.construct(a,c)};g=a.Dir.prototype=new a.Item;g.ancestor=a.Item.prototype;g.construct=function(a,c){this.isdir=!0;this.type="dir";this.dirsize=0;this.items={};this.itemsArray=[];this.selectedItems=[];this.busyItems=[];this.files={};this.subdirs={};this.ancestor.construct.apply(this,arguments)};
g.createElements=function(){var b,c,d;this.itemEl||(this.ancestor.createElements.apply(this,arguments),this.itemEl.className+=" dir",this.contentEl=a.createTemplateEl("dirContent"),this.subtreeEl=a.createTemplateEl("subtree"),d=this.branchEl=a.createTemplateEl("branch"),d.className+=" dir",b=this.branchHeadEl=a.byClass("branch-head",d)[0],b.onclick=a.eBranchHeadClick,b.oncontextmenu=a.eBranchHeadContextmenu,b.onmouseover=a.eBranchHeadMouseover,b.onmouseout=a.eBranchHeadMouseout,b.onmousedown=a.eBranchHeadMousedown,
this.branchNameEl=a.byClass("branch-name",b)[0],c=this.branchControlEl=a.byClass("branch-control",b)[0],c.onclick=a.eBranchControlClick,d.Dir=b.Dir=c.Dir=this)};g.setContent=function(a){var c,d=a.files||{};this.extend(a.props);this.addSubdirs(a.subdirs);for(c in this.files)d[this.files[c].name]||this.removeItem(this.files[c]);this.addFiles(d);this.content=a;this.checkRemoveSubtree();this.maySortItems();this.sortTree()};g.addFiles=function(b){this.addItems(b,a.File)};g.addSubdirs=function(b){this.addItems(b,
a.Dir)};g.addItems=function(a,c){var d,e;if(a)for(e in a)(d=this.items[":"+e])?this.updateItem(d,a[e]):(d=new c(e,a[e]),this.appendItem(d))};g.updateItem=function(a,c){a.extend(c);this.updateStat();this.updateView()};g.appendItem=function(a){if(this.validateAppend(a)){var c=":"+a.name,d=a.parent,e=this.items;d&&d.removeItem(a,!0);e[c]&&this.removeItem(e[c]);e[c]=a;this.itemsArray.push(a);a.parent=this;a.setContainer(this);a.isfile?this.files[c]=a:a.isdir&&(this.prepareSubtree(),this.subtreeEl.appendChild(a.branchEl),
this.subdirs[c]=a,a.setPath((this.parent?this.path+"/":"")+a.name));a.size&&(this.dirsize+=a.size);this.listViewReady&&a.processListView();this.updateStat();this.updateView()}};g.removeItem=function(b,c,d){var e;if(b.parent===this){if(!c){if(b.isdir)for(e in b.items)b.removeItem(b.items[e],!1);b.container&&b.container!==this&&b.container.removeItem(b)}e=":"+b.name;b.deselect();b.setBusy(!1);b===a.hoveringItem&&k(b.itemEl).mouseout();b.isdir?(b.active&&this.activate(),b.unsetPath(),delete this.subdirs[e],
a.removeEl(b.branchEl),this.checkRemoveSubtree()):b.isfile&&delete this.files[e];this.itemsArray.splice(d===q?this.getItemIndex(b):d,1);delete b.parent;delete b.container;delete this.items[e];a.removeEl(b.itemEl);b.size&&(this.dirsize-=b.size);this.updateStat();this.updateView()}};g.setPath=function(b){var c;this.unsetPath();this.path=b;a.tree[b]=this;this.setDisabled(!this.getConf());for(c in this.subdirs)this.subdirs[c].setPath(b+"/"+this.subdirs[c].name);this.updateStat()};g.unsetPath=function(){var b;
if(this.path){for(b in this.subdirs)this.subdirs[b].unsetPath();delete a.tree[this.path];delete this.path}};g.open=function(a){!a&&this.content||this.load();this.activate()};g.load=function(){this.isOperable()&&(this.setLoading(!0),a.ajax("browse",{data:{activeDir:this.path},success:a.dirLoadSuccess,complete:a.dirLoadComplete}))};g.activate=function(b){var c=a.activeDir,d=this.parent;if(!this.active){c&&c.deactivate();this.needSort?this.sortItems():this.needDomSort&&(this.needDomSort=0,this.resetItemsDom());
a.activeDir=this;this.setState("active",this.branchHeadEl);this.loading?(a.setContentsLoading(!0),this.deselectAllItems()):this.prepareContent();a.els.contents.scrollTop=0;a.listViewing&&a.updateListHead();this.setContentDisplay(!0);for(b||a.historySave();d;)d.expand(!0),d=d.parent;a.invoke("dirActivate",this,c);this.updateStat();this.updateView();a.updateSortBy()}};g.deactivate=function(){this.active&&(this.loading&&a.setContentsLoading(!1),this.setContentDisplay(!1),this.deselectAllItems(),a.activeDir=
null,this.unsetState("active",this.branchHeadEl))};g.setLoading=function(b){b?this.loading||(this.setBusy(!0),this.setState("loading",this.itemEl,this.branchHeadEl),this.active&&(a.setContentsLoading(!0),this.deselectAllItems())):this.loading&&(this.setBusy(!1),this.unsetState("loading",this.itemEl,this.branchHeadEl),this.active&&(a.setContentsLoading(!1),this.prepareContent()))};g.setDisabled=function(a){a?this.disabled||this.setState("disabled",this.branchHeadEl,this.itemEl):this.disabled&&this.unsetState("disabled",
this.branchHeadEl,this.itemEl)};g.getPerm=function(a){var c=this.getPerms();return!!(c&&(c[a]===q?c.all:c[a]))};g.getPerms=function(){var a=this.getConf();return a&&a.perms};g.getConf=function(){var b;if(b=this.path){if((b=a.conf.dirConf[b])&&!b.call)return b;if(this.parent)return this.parent.getSubdirConf()}};g.getSubdirConf=function(){var a=this.getConf(),c=a&&a.subdirConf;if(c)return c.inherit?a:c};g.removeNames=function(a,c){if(a)for(var d in a)this.removeName(a[d],c)};g.removeName=function(a,
c){var d;(d=this.items[":"+a])&&this.removeItem(d,c)};g.getItemByName=function(a){return this.items[":"+a]};g.selectAllItems=function(){for(var a in this.itemsArray)this.itemsArray[a].select()};g.deselectAllItems=function(){for(var a=this.selectedItems,c=a.length-1;-1!==c;c--)a[c].deselect(c)};g.saveSelectionState=function(a){a?delete this.lastSelection:this.lastSelection=this.getSelectedItems()};g.selectItemsByCoords=function(b,c,d,e,f){var g,h,k=this.lastSelection;if(f&&k&&k.length)for(g=0;f=this.itemsArray[g];g++)h=
a.isIn(f,k),f.isInsideCoords(b,c,d,e)?h?f.deselect():f.select():h?f.select():f.deselect();else for(g=0;f=this.itemsArray[g];g++)f.isInsideCoords(b,c,d,e)?f.select():f.deselect()};g.updateItemsCoords=function(){for(var b,c=0;b=this.itemsArray[c];c++)a.updateElCoords(b.itemEl)};g.getLastSelectedItem=function(){var a=this.selectedItems,c=a.length;if(c)return a[c-1]};g.getItemByIndex=function(a){return this.itemsArray[a]};g.countItems=function(){return this.itemsArray.length};g.getSelectedItems=function(){return this.selectedItems.slice(0)};
g.groupSelectedItems=function(){var a={},c=this.getSelectedItems();c.length&&(a[this.path]=c);return a};g.countSelectedItems=function(){return this.selectedItems.length};g.countBusyItems=function(){return this.busyItems.length};g.countSubdirs=function(){return this.subtreeEl.children.length};g.getSelectedItemsSize=function(){var a,c=0,d=this.selectedItems;for(a in d)c+=d[a].size||0;return c};g.formatContentStat=function(){return a.formatItemsStat(this.countItems(),this.dirsize)};g.formatSelectedItemsStat=
function(){var b=this.countSelectedItems();return b?a.t("Selected: !stat",{"!stat":a.formatItemsStat(b,this.getSelectedItemsSize())}):a.t("No items selected")};g.getItemIndex=function(b){return a.inArray(b,this.itemsArray)};g.nameOnChange=function(b){this.ancestor.nameOnChange.apply(this,arguments);this.branchNameEl.innerHTML=a.innerText(this.name)};g.itemNameOnChange=function(a,c){var d=":"+a.name,e=":"+c;delete this.items[e];this.items[d]=a;this.files[e]?(delete this.files[e],this.files[d]=a):this.subdirs[e]&&
(delete this.subdirs[e],this.subdirs[d]=a,a.setPath((this.parent?this.path+"/":"")+a.name))};g.itemSizeOnChange=function(a,c){c!==q&&(this.dirsize+=a.size-c)};g.dblClick=function(){this.open()};g.prepareContent=function(){var b=this.contentEl,c=a.els.contents;a.listViewing&&this.prepareListView();b.parentNode!==c&&(b.setAttribute("data-empty",a.t("This folder is empty.")),c.appendChild(b))};g.setContentDisplay=function(b){var c=this.contentEl;c.parentNode===a.els.contents&&b^c.offsetWidth&&(c.style.display=
b?"":"none")};g.prepareSubtree=function(){this.subtreeEl.parentNode!==this.branchEl&&(this.branchEl.appendChild(this.subtreeEl),a.removeClass(this.branchHeadEl,"leaf"),!this.active&&a.activeDir?(this.expanded=!0,this.shrink(!0)):this.expand(!0))};g.checkRemoveSubtree=function(){this.countSubdirs()||(this.shrink(!0),a.removeEl(this.subtreeEl),a.addClass(this.branchHeadEl,"leaf"))};g.updateStat=function(){this.active&&a.delayedUpdateActiveDirStat()};g.updateView=function(){this.active&&a.delayedUpdateActiveDirView()};
g.maySortItems=function(){this.active?this.sortItems():this.needSort=1};g.sortItems=function(b,c,d){var e,f=this.itemsArray,g=1<f.length;this.needSort=0;g&&d||(this.needDomSort=0);b||(b=this.sortKey||a.lastSortKey||"name");c||(c=this.sortDir||a.lastSortDir||"asc");(e=a.sorters[b])&&e.func&&(g&&(f.sort(e.func),"desc"===c&&f.reverse(),d||this.resetItemsDom()),this.sortKey=a.lastSortKey=b,this.sortDir=a.lastSortDir=c,this.active&&a.updateSortBy())};g.resetItemsDom=function(){var a,c,d=this.itemsArray,
e=this.contentEl;for(c=0;a=d[c];c++)e.appendChild(a.itemEl)};g.sortTree=function(){if(1<this.countSubdirs()){var b,c,d=[];for(b in this.subdirs)d.push(this.subdirs[b]);d.sort(a.sortBranchName);for(c=0;b=d[c];c++)this.subtreeEl.appendChild(b.branchEl)}};g.formatType=function(){return a.t("Folder")};g.validateAppend=function(a,c){if(a===this)return!1;var d=a.parent;if(!d)return!0;if(!c&&d===this)return!1;if(a.isdir)for(d=this.parent;d;d=d.parent)if(d===a)return!1;return!0};g.isOperable=function(){return!(this.busy||
this.disabled||this.hasBusyItems())};g.getFirstInoperableSelectedItem=function(){var a,c,d=this.selectedItems;for(a in d)if(c=d[a],!c.isOperable())return c};g.getFirstSelectedItem=function(b,c){return a.getFirstIn(this.selectedItems,b,c)};g.hasBusyItems=function(){if(this.countBusyItems())return!0;for(var a in this.subdirs)if(this.subdirs[a].hasBusyItems())return!0;return!1};g.isPredefined=function(){var b=this.path,b=b&&a.conf.dirConf[b];return!(!b||b.derived||b.call)};g.hasPredefinedPath=function(){var a,
c=this.path;if(this.isPredefined())return c;for(a in this.subdirs)if(c=this.subdirs[a].hasPredefinedPath())return c;return!1};g.expand=function(b){this.expanded||!b&&!this.countSubdirs()||(this.setState("expanded",this.branchHeadEl),a.showEl(this.subtreeEl),a.itemDragging&&setTimeout(function(){a.setMaxSVals(a.els.tree)}))};g.shrink=function(b){this.expanded&&(b||this.countSubdirs())&&(this.unsetState("expanded",this.branchHeadEl),a.hideEl(this.subtreeEl))};g.prepareListView=function(){if(!this.listViewReady){this.listViewReady=
1;for(var a in this.itemsArray)this.itemsArray[a].processListView()}};g.setSelectedItem=function(b){var c=this.selectedItems;c.push(b);this.active&&(3>c.length&&a.delayedUpdatePreview(),this.updateStat())};g.unsetSelectedItem=function(b,c){var d=this.selectedItems;c===q&&(c=a.inArray(b,d));-1!==c&&(d.splice(c,1),this.active&&(2>d.length&&a.delayedUpdatePreview(),this.updateStat()))};g.setBusyItem=function(a){this.busyItems.push(a)};g.unsetBusyItem=function(b){var c=this.busyItems;b=a.inArray(b,c);
-1!==b&&c.splice(b,1)};g.empty=function(){for(var a=this.itemsArray,c=a.length-1;-1!==c;c--)this.removeItem(a[c],!1,c)};a.template.branch='<div class="branch"><div class="branch-head"><span class="branch-control"></span><span class="branch-icon"></span><span class="branch-name"></span></div></div>';a.template.subtree='<div class="subtree"></div>';a.template.dirContent='<div class="dir-content clearfix"></div>';a.eBranchHeadMousedown=function(b){b=b||p.event;this.preventClick=0;this!==(b.target||b.srcElement)&&
(a.draggingDir=this.Dir,a.addClass(this,"dragging"),a.bindDragDrop(a.eBranchHeadDrag,a.eBranchHeadDrop));return!1};a.eBranchHeadDrag=function(b){return a.eCommonItemDrag(b)};a.eBranchHeadDrop=function(b){var c,d=a.draggingDir;a.draggingDir=null;a.removeClass(d.branchHeadEl,"dragging");a.itemDragging&&(a.itemDragging=0,a.removeClass(l.body,"dfm-dragging"),p.ActiveXObject&&(l.body.style.cursor="auto"),d.branchHeadEl.preventClick=1,(c=a.hoveringItem||a.hoveringDir)&&d.parent&&a.appendDirItems(d.groupSelf(),
c,b.ctrlKey))};a.eBranchHeadClick=function(b){var c=this.Dir;b=a.eFix(b);this.preventClick||c.active||c.open();b.preventDefault()};a.eBranchHeadContextmenu=function(b){b=a.eFix(b);var c=this.Dir;a.addClass(this,"cm");a.showCM({top:b.pageY,left:b.pageX,treeCM:!0,Dir:c,target:c,onhide:a.eBranchHeadContextmenuHide,cname:"tree-cm"});b.preventDefault();b.stopPropagation()};a.eBranchHeadContextmenuHide=function(b){a.removeClass(b.Dir.branchHeadEl,"cm")};a.eBranchHeadMouseover=function(b){b=b||p.event;a.checkLineage(this,
b.relatedTarget||b.fromElement,3)||a.setHoveringDir(this.Dir,a.itemDragging&&k.browser.safari,a.eFix(b))};a.eBranchHeadMouseout=function(b){b=b||p.event;a.checkLineage(this,b.relatedTarget||b.toElement,3)||a.setHoveringDir(null,k.browser.safari)};a.eBranchControlClick=function(b){var c=this.Dir;b=a.eFix(b);c.countSubdirs()?c.expanded?c.shrink(!0):c.expand(!0):c.active&&c.content||c.open();b.stopPropagation();b.preventDefault()};a.setHoveringDir=function(b,c,d){a.hoveringDir!=b&&(a.hoveringDir&&(clearTimeout(a.branchHoverExpandTimer),
a.setCursorDropState(),c&&a.removeClass(a.hoveringDir.branchHeadEl,"draghover"),a.hoveringDir=null),b&&d&&(a.hoveringDir=b,a.branchHoverExpandTimer=setTimeout(a.branchHoverExpand,1E3),a.eSetItemHoverDropState(b,d.ctrlKey),c&&a.addClass(b.branchHeadEl,"draghover")))};a.branchHoverExpand=function(){var b=a.hoveringDir;b&&a.itemDragging&&(b.content||!b.isOperable()?b.expand():b.load())};a.delayedUpdateActiveDirStat=function(){clearTimeout(a.updateDirStatTimer);a.updateDirStatTimer=setTimeout(a.updateActiveDirStat,
100)};a.updateActiveDirStat=function(){var b=a.activeDir,c=a.activeDirStat=a.activeDirStat||{},d=a.byId,e=b.formatFullPath(),f=b.formatContentStat(),b=b.formatSelectedItemsStat(),g=a.els.main,h=g.offsetHeight;c.path!==e&&(d("dfm-stat-path").innerHTML=c.path=e);c.content!==f&&(d("dfm-stat-content").innerHTML=c.content=f);c.selected!==b&&(d("dfm-stat-selected").innerHTML=c.selected=b);g.offsetHeight!==h&&a.eWinResize()};a.delayedUpdateActiveDirView=function(){a.hooks.updateItemView&&(clearTimeout(a.updateDirViewTimer),
a.updateDirViewTimer=setTimeout(a.updateActiveDirView,250))};a.updateActiveDirView=function(){var b,c,d,e,f,g=a.hooks.updateItemView;if(g&&(f=a.visibleItemsRange()))for(d=a.activeDir.itemsArray,b=f.start;b<f.end;b++)if(e=d[b],!e.viewUpdated){for(c in g)g[c](e);e.viewUpdated=1}};a.visibleItemsRange=function(){var b,c,d,e,f=a.els.contents;d=a.activeDir.itemsArray;if(c=d.length){b={start:0,end:c};if(f.clientHeight<f.scrollHeight){d=a.elPerRow(d[0].itemEl);e=f.scrollHeight/Math.ceil(c/d);if(c=f.scrollTop)b.start=
Math.round(c/e)*d;b.end=Math.min(b.end,b.start+Math.ceil(f.clientHeight/e)*d)}return b}};a.ConDir=function(a,c){this.construct(a,c)};g=a.ConDir.prototype=new a.Dir;g.construct=function(b,c){this.iscondir=!0;a.Dir.prototype.construct.apply(this,arguments)};g.createElements=function(){this.itemEl||(a.Dir.prototype.createElements.apply(this,arguments),this.branchEl.className+=" condir")};g.appendItem=function(b){var c=this.itemsArray;this.validateAppend(b)&&!a.isIn(b,c)&&(c.push(b),this.listViewReady&&
b.processListView(),this.active&&b.setContainer(this),b.size&&(this.dirsize+=b.size),this.updateStat(),this.updateView())};g.validateAppend=function(a){return a.parent&&a.container!==this?!0:!1};g.removeItem=function(b,c,d){c=this.itemsArray;d===q&&(d=a.inArray(b,c));-1!==d&&(this.active&&(b.deselect(),b===a.hoveringItem&&k(b.itemEl).mouseout(),b.parent?b.restoreContainer():b.setContainer(null)),c.splice(d,1),b.size&&(this.dirsize-=b.size),this.updateStat(),this.updateView())};g.open=function(a){a&&
this.load();this.activate()};g.load=function(){};g.activate=function(){var b,c,d,e=this.itemsArray;b=a.activeDir;if(!this.active){b&&b.deactivate();b=0;for(d=[];c=e[b];b++)c.parent?c.setContainer(this):d.push(c);for(b in d)this.removeItem(d[b]);a.Dir.prototype.activate.call(this,!0)}};g.deactivate=function(){if(this.active){var b,c=this.itemsArray;a.Dir.prototype.deactivate.apply(this,arguments);for(b in c)c[b].restoreContainer()}};g.groupSelectedItems=function(){return a.groupItemsByPath(this.selectedItems)};
g.isOperable=function(){return!1};g.formatFullPath=function(){return a.plain(this.name)};a.load=function(b,c){var d={},e=a.urlParam("initActiveDir");if(e)d.initActiveDir=e;else if(e=a.urlParam("fallbackDir"))d.fallbackDir=e;"string"===typeof c&&(c={url:c});c.data=a.extend(d,c.data);a.els.parent=b.nodeType?b:a.byId(b);a.initialOptions=c;a.conf.scriptUrl=c.url;a.setUILoading(!0);a.ajax("load",a.extend({success:a.loadSuccess,complete:a.loadComplete},c))};a.init=function(){var b,c,d=a.conf;a.extend(a.i18n,
d.i18n);a.initEnv();a.fixBrowser();a.initMainUI();a.initTbis();a.initTree();d.thumbUrl&&a.registerHook("updateItemView","main",a.setItemThumb);d.initListView&&a.setListView(!0);a.invoke("init");a.initIntegration();a.setUILoading(!1);a.initFullPage();a.dirLoadSuccess(d);(b=d.activeDir)&&(c=a.tree[b])&&c.activate();a.invoke("ready")};a.initMainUI=function(){var b,c=a.els,d=a.byId;p.onbeforeunload=a.eWinBeforeunload;a.$doc=k(l).mousemove(a.eDocMousemove).keydown(a.eDocKeydown).keyup(a.eDocKeyup);b=c.main=
a.htmlEl('<div id="dfm" tabindex="0"><div id="dfm-head"><div id="dfm-toolbar" class="clearfix"></div></div><div id="dfm-body"><div id="dfm-tree" tabindex="0"></div><div id="dfm-tree-resizer"><div class="xr"></div></div><div id="dfm-preview"><div id="dfm-item-preview"></div></div><div id="dfm-preview-resizer"><div class="xr"></div></div><div id="dfm-contents" tabindex="0"></div></div><div id="dfm-foot"><div id="dfm-statusbar" class="clearfix"><span id="dfm-stat-path" class="stat"></span><span id="dfm-stat-content" class="stat"></span><span id="dfm-stat-selected" class="stat"></span></div></div></div>');
b.onkeydown=a.eMainKeydown;c.parent.appendChild(b);b=c.toolbar=d("dfm-toolbar");b.onmousedown=a.eToolbarMousedown;c.body=d("dfm-body");b=c.tree=d("dfm-tree");b.onkeydown=a.eTreeKeydown;b.onmousedown=a.eTreeMousedown;b.ontouchstart=a.eTreeTouchstart;b=c.contents=d("dfm-contents");b.onclick=a.eContentsClick;b.oncontextmenu=a.eContentsContextmenu;b.onmousedown=a.eContentsMousedown;b.ontouchstart=a.eContentsTouchstart;b.onkeydown=a.eContentsKeydown;b.onmouseover=a.eContentsMouseover;b.onmouseout=a.eContentsMouseout;
b.onscroll=a.eContentsScroll;c.preview=d("dfm-preview");c.itemPreview=d("dfm-item-preview");b=c.treeResizer=d("dfm-tree-resizer");a.setDragDrop(b,a.eTreeResizerDrag,null,a.eResizerDown);b=c.previewResizer=d("dfm-preview-resizer");a.setDragDrop(b,a.ePreviewResizerDrag,null,a.eResizerDown)};a.initEnv=function(){var b=a.cookie("dfmLV");""!==b&&(a.conf.initListView=1*b);b=a.cookie("dfmPWC");""!==b&&(a.prvWidgetClosed=1*b);a.lastSortKey=a.cookie("dfmLSK")||"name";a.lastSortDir=a.cookie("dfmLSD")||"asc"};
a.fixBrowser=function(){if(k.browser.msie){var b=a.int(k.browser.version),c=l.body;k("<style>body.dfm-dragging, body.dfm-dragging * {cursor: url("+a.conf.scriptDirUrl+"/core/misc/grabbing.cur), move !important}</style>").appendTo(c);a.addClass(c,"ie");10>b&&(a.addClass(c,a.lte9="lte9"),9>b&&(a.addClass(c,a.lte8="lte8"),8>b&&a.addClass(c,a.lte7="lte7")))}};a.initTbis=function(){a.addTbi("cl",{title:a.t("Change layout"),onclick:a.eTbiClClick,cname:"right no-title"});a.addTbi("cv",{title:a.t("Change view"),
onclick:a.eTbiCvClick,cname:"right no-title"});a.addTbi("up",{title:a.t("Up"),onclick:a.eTbiUpClick});a.addTbi("refresh",{title:a.t("Refresh"),onclick:a.eTbiRefreshClick,shortcut:"F5"});a.addTbi("sortby",{title:a.t("Sort by"),onclick:a.eTbiSortByClick,cname:"right no-title"});a.addTbi("actions",{title:a.t("Actions"),onclick:a.eTbiActionsClick});a.sorters.name={title:a.t("Name"),func:a.sortItemName};a.sorters.date={title:a.t("Date"),func:a.sortItemDate};a.sorters.size={title:a.t("Size"),func:a.sortItemSize};
a.sorters.ext={title:a.t("Type"),func:a.sortItemExt};a.addCmi("selectall",{title:a.t("Select all"),shortcut:"Ctrl+A",onclick:function(a,c){c.target.selectAllItems()},stateCallback:function(a){return a.contentsCM}});a.addCmi("open",{title:a.t("Open"),shortcut:"Enter",onclick:function(a,c){c.target.open()},stateCallback:function(a){return a.itemCM}})};a.initTree=function(){var b,c=new a.Dir(a.rootName());c.setPath(".");c.branchHeadEl.className+=" root";a.els.tree.appendChild(c.branchEl);c.isroot=!0;
for(b in a.conf.dirConf)a.addDir(b)};a.initFullPage=function(){a.hasClass(l.body,"dfm")&&((p.onresize=a.eWinResize)(),a.els.contents.focus())};a.shortcuts.main.k116=function(b){a.activeDir.load()};a.htmlToNode=a.htmlEl;a.registerInit("delete",function(){if(a.permExists("deleteFiles")||a.permExists("deleteFolders"))a.addCmi("delete",{title:a.t("Delete"),shortcut:"DEL",onclick:function(b,c){c.treeCM?a.deleteDir(c.target):c.itemCM&&a.deleteSelectedItems()},stateCallback:function(b){if(b.treeCM)return a.deleteDirValidate(b.target,
!0);if(b.itemCM)return a.deleteSelectedItemsValidate(!0)}}),a.shortcuts.contents.k46=function(b){a.deleteSelectedItems()},a.shortcuts.tree.k46=function(b){a.deleteDir(a.activeDir)}});a.deleteSelectedItemsValidate=function(b){return!a.activeDir.busy&&a.validateSelectionCommon("deleteFiles","deleteFolders",!0,!0,b)};a.deleteSelectedItems=function(){if(a.deleteSelectedItemsValidate()){var b=a.getSelectedItems(),c=b.length,c=1==c?a.deleteConfirmMsg(b[0].name):a.t("Are you sure want to delete the selected !count items?",
{"!count":c});confirm(c)&&a.deleteItems(b)}};a.deleteDirValidate=function(b,c){return a.validateSelectedDir(b,"deleteFolders",!0,c)};a.deleteDir=function(b){a.deleteDirValidate(b)&&confirm(a.deleteConfirmMsg(b.path))&&a.deleteItems([b])};a.deleteItems=function(b){(b=a.ajaxifyItems(b))&&a.ajax("delete",b)};a.deleteConfirmMsg=function(b){return a.t("Are you sure want to delete !name?",{"!name":b})};a.registerInit("move",function(){a.addCmi("cut",{title:a.t("Cut"),shortcut:"Ctrl+X",onclick:function(b,
d){d.treeCM?a.cbDir(d.target):d.itemCM&&a.cbSelectedItems()},stateCallback:function(b){if(b.treeCM)return a.cbDirValidate(b.target);if(b.itemCM)return a.cbSelectedItemsValidate()}});a.addCmi("copy",{title:a.t("Copy"),shortcut:"Ctrl+C",onclick:function(b,d){d.treeCM?a.cbDir(d.target,!0):d.itemCM&&a.cbSelectedItems(!0)},stateCallback:function(b){if(b.treeCM)return a.cbDirValidate(b.target,!0);if(b.itemCM)return a.cbSelectedItemsValidate(!0)}});a.addCmi("paste",{title:a.t("Paste"),shortcut:"Ctrl+V",
onclick:function(b,d){d.target.isdir&&a.cbPaste(d.target)},stateCallback:function(b){return b.target&&b.target.isdir&&a.cbPasteValidate(b.target)}});a.registerHook("appendDirItemsValidate","move",function(b,d,e){return a.pasteDirItemsPerm(b,d,e)});a.registerHook("appendDirItems","move",function(b,d,e){a.pasteDirItems(b,d,e)});var b=a.shortcuts;b.contents.ctrl.k88=function(b){a.cbSelectedItems()};b.contents.ctrl.k67=function(b){a.cbSelectedItems(!0)};b.contents.ctrl.k86=function(b){a.cbPaste(a.activeDir)};
b.tree.ctrl.k88=function(b){a.cbDir(a.activeDir)};b.tree.ctrl.k67=function(b){a.cbDir(a.activeDir,!0)};b.tree.ctrl.k86=function(b){a.cbPaste(a.activeDir)}});a.cbSelectedItemsValidate=function(b){var c=a.activeDir,d=b?"copy":"move";return!c.busy&&!c.disabled&&a.validateSelectionCommon(d+"Files",d+"Folders",!1,!b,!0)};a.cbSelectedItems=function(b){a.cbSelectedItemsValidate(b)&&a.cbSet(a.activeDir.groupSelectedItems(),b)};a.cbDirValidate=function(b,c){return a.validateSelectedDir(b,(c?"copy":"move")+
"Folders",!c,!0)};a.cbDir=function(b,c){a.cbDirValidate(b,c)&&a.cbSet(b.groupSelf(),c)};a.cbPasteValidate=function(b){var c=a.cb.dirItems,d,e;if(c){if(a.validateAppendDirItems(c,b,a.cb.copy))return!0;for(d in c){b=a.tree[d];if(!b)return a.cbReset();for(e in c[d])if(c[d][e].parent!==b)return a.cbReset()}}};a.cbPaste=function(b){a.cbPasteValidate(b)&&(a.pasteDirItems(a.cb.dirItems,b,a.cb.copy),a.cbReset())};a.pasteDirItems=function(b,c,d){var e,f,g,h,k,l,n={},p=0,q={},r=[];for(e in b)for(f in g=a.tree[e],
l=d&&g===c,k=b[e],n[e]={},k){h=k[f];g=!l&&c.getItemByName(h.name);if(h.isdir&&g&&g.isdir&&!a.validateDirPredefined(g))return!1;if(!h.isOperable())return a.setMessage(a.t("%filename is not operable.",{"%filename":h.name})),!1;g&&(q[e]||(q[e]={}),q[e][f]=h.name,r.push(h.name));n[e][f]=h;p++}if(!p||!d&&(b=1==p?a.t("Are you sure want to move !name to !dirname?",{"!name":h.name,"!dirname":c.name}):a.t("Are you sure want to move the selected !count items to !dirname?",{"!count":p,"!dirname":c.name}),!confirm(b)))return!1;
if(b=r.length)if(d&&a.$doc.keyup(),b=1==b?a.t("Do you want to overwrite existing !name?",{"!name":r[0]}):a.t("Do you want to overwrite existing !count items?\n!names",{"!count":b,"!names":"* "+(15<b?r.slice(0,15).join("\n* ")+"\n...":r.join("\n* "))}),!confirm(b))for(e in q)for(f in q[e])delete n[e][f],p--;if(!p)return!1;e=a.ajaxifyItems(n);e.data.destDir=c.path;a.ajax(d?"copy":"move",e)};a.pasteDirItemsPerm=function(b,c,d){var e,f,g;f=d?"copy":"move";d=f+"Files";var h=f+"Folders";for(e in b)if(f=
a.tree[e],g=b[e],a.getFirstIn(g,"isfile")&&(!c.getPerm(d)||!f.getPerm(d))||a.getFirstIn(g,"isdir")&&(!c.getPerm(h)||!f.getPerm(h)))return!1;return!0};a.cbSet=function(b,c){a.cbReset();a.cb.copy=c;a.cb.dirItems=b;c||a.setItemsCutState(b,!0)};a.cbReset=function(){a.cb.dirItems&&(a.cb.copy||a.setItemsCutState(a.cb.dirItems,!1),a.cb.dirItems=a.cb.copy=null)};a.setItemsCutState=function(b,c){var d,e,f,g=c?a.setState:a.unsetState;for(d in b)for(e in b[d])f=b[d][e],g(f,"cut",f.itemEl,f.branchHeadEl)};a.showRW=
function(b){var c=a.els.RW;b||(b={});c||(c=a.els.RW=a.newEl("textarea"),c.className="dfm-widget",c.wrap="off",c.id="dfm-rename-widget",c.onkeydown=a.eRWKeydown,c.onkeypress=a.eRWKeypress,c.onkeyup=a.eRWKeyup,l.body.appendChild(c));c.opt=b;b.vertical&&(c.className+=" vertical",c.removeAttribute("wrap"));c.ActiveEl=l.activeElement;a.setPageOverlay(!0,a.eRWSubmit);k(c).css(b.css).val(b.value||"").show().focus().select();b.vertical?a.setScrollHeight(c):a.setScrollWidth(c);return c};a.hideRW=function(){var b=
a.els.RW;b&&(a.hideEl(b),b.removeAttribute("style"),b.className="dfm-widget",b.wrap="off",a.setPageOverlay(!1),b.opt=null,b.ActiveEl&&setTimeout(function(){b.ActiveEl.focus()}))};a.elRWCss=function(b){return a.extend(a.absPos(b),{width:b.offsetWidth+2})};a.itemRWOpt=function(b,c){var d={value:b.name,args:[b],css:a.elRWCss(b.itemNameEl)};a.listViewing||(d.css.left=a.absPos(b.itemEl).left,d.css.width=b.itemEl.offsetWidth-2,d.vertical=!0);return a.extend(d,c)};a.branchRWOpt=function(b,c){return a.extend({value:b.name,
args:[b],css:a.elRWCss(b.branchNameEl)},c)};a.eRWKeydown=function(b){b||(b=p.event);if(13==b.keyCode||27==b.keyCode)return a.eRWSubmit(a.eFix(b)),!1};a.eRWKeypress=function(b){this.opt&&(this.opt.vertical?a.setScrollHeight(this):a.setScrollWidth(this))};a.eRWKeyup=function(b){this.opt&&(this.opt.vertical?a.setScrollHeight(this):a.setScrollWidth(this))};a.eRWSubmit=function(b){var c=a.els.RW,d=c.opt;if((b=27==b.keyCode?d.cancel:d.submit)&&b.apply&&!1===b.apply(c,[c.value].concat(d.args)))return c.focus(),
!1;a.hideRW()};a.registerInit("rename",function(){if(a.permExists("renameFiles")||a.permExists("renameFolders"))a.addCmi("rename",{title:a.t("Rename"),shortcut:"F2",onclick:function(b,c){c.treeCM?a.renameDir(c.target):c.itemCM&&a.renameSelectedItem(c.target)},stateCallback:function(b){if(b.treeCM)return a.renameDirValidate(b.target,!0);if(b.itemCM)return a.renameSelectedItemValidate(b.target,!0)}}),a.shortcuts.contents.k113=function(b){a.renameSelectedItem()},a.shortcuts.tree.k113=function(b){a.renameDir(a.activeDir)}});
a.renameSelectedItemValidate=function(b,c){b||(b=a.activeDir.getFirstSelectedItem());if(b&&b.isOperable()){var d=b.parent;if(d&&!d.busy){if(b.isfile){if(!d.getPerm("renameFiles"))return}else if(!d.getPerm("renameFolders")||!a.validateDirPredefined(b,c))return;return b}}};a.renameSelectedItem=function(b){if(b=a.renameSelectedItemValidate(b)){a.scrollToEl(b.itemEl,a.els.contents);var c=a.showRW(a.itemRWOpt(b,{submit:a.renameWidgetSubmit}));b=b.name.lastIndexOf(".");0<b&&c.setSelectionRange&&c.setSelectionRange(0,
b)}};a.renameDirValidate=function(b,c){return a.validateSelectedDir(b,"renameFolders",!0,c)};a.renameDir=function(b){a.renameDirValidate(b)&&(a.scrollToEl(b.branchEl,a.els.tree),a.showRW(a.branchRWOpt(b,{submit:a.renameWidgetSubmit})))};a.renameWidgetSubmit=function(b,c){var d=k.trim(b),e=c.parent,f,g;if(f=e.getItemByName(d))return f===c?null:a.setMessage(a.t("%filename already exists.",{"%filename":d}));if(c.isfile&&!a.renameValidateFileRename(c.name,d)||!a.validateFileName(d))return!1;f=a.ajaxifyItems([c]);
c.oldname=c.name;c.setName(d);g=c.isfile?"files":"subdirs";f.busyNames[e.path][g]=f.data["new"+g+"[0][]"]=[d];f.busyItemCallback=a.renameBusyItemComplete;f.data.activeDir=e.path;a.ajax("rename",f)};a.renameValidateFileRename=function(b,c){var d,e=a.conf,f=e.renameExtensions||e.uploadExtensions||[],g=!e.uploadInsecure,h=!f.length||"*"!==f[0],k=a.fileExt(b),l=a.fileExt(c);if(k!==l){if(!f.length||!e.renameExtensionAlter)return a.setMessage(a.t("The %ext extension can not be changed.",{"%ext":k})),!1;
if(h&&!a.isIn(l,f))return a.setMessage(a.t("Allowed file extensions are %extensions.",{"%extensions":f.join(", ")})),!1;if(g&&(d=e.execExtensions)&&a.isIn(l.toLowerCase(),d))return a.setMessage(a.t("%filename is not secure.",{"%filename":c})),!1}return g&&h&&c!==a.neutralizeFileName(c,f)?(a.setMessage(a.t("%filename is not secure.",{"%filename":c})),!1):!0};a.neutralizeFileName=function(b,c){var d,e,f,g,h,k=b.split(".");if(k[2]===q)return b;e=k.shift();f=k.pop();h=/^[a-zA-Z]{2,5}\d?$/;for(d in k)g=
k[d],e+="."+g,!a.isIn(g,c)&&h.test(g)&&(e+="_");return e+"."+f};a.renameBusyItemComplete=function(a,c,d,e){c=this.response&&this.response.added;var f;c&&c[e]&&(f=c[e][d])&&f[a.name]||a.oldname===q||(a.setName(a.oldname),delete a.oldname)};a.registerInit("newdir",function(){if(a.permExists("createFolders")){var b,c=a.addTbi("newdir",{title:a.t("New folder"),shortcut:"Ctrl+N",onclick:function(b){a.newdirCreate()}});(b=a.tbis.sortby)&&a.insertAfter(c.el,b.el);a.registerHook("dirActivate","newdir",function(b,
c){a.tbis.newdir.setDisabled(!b.getPerm("createFolders"))});a.shortcuts.main.ctrl.k78=function(b){a.newdirCreate()}}});a.newdirCreateValidate=function(){var b=a.activeDir;return!b.busy&&!b.readonly&&b.getPerm("createFolders")};a.newdirCreate=function(){if(a.newdirCreateValidate()){var b=a.activeDir,c,d,e,f=a.els.contents;c=d=a.t("New folder");for(e=1;b.getItemByName(c);e++)c=d+" "+e;f.focus();c=new a.Dir(c);c.appendTo(b);c.click();b.sortItems();a.scrollToEl(c.itemEl,f);a.showRW(a.itemRWOpt(c,{submit:a.newdirWidgetSubmit,
cancel:a.newdirRWCancel}))}};a.newdirWidgetSubmit=function(b,c){var d=k.trim(b),e=c.parent.getItemByName(d);if(e&&e!==c)return a.setMessage(a.t("%filename already exists.",{"%filename":d}));if(!a.validateFileName(d))return!1;c.setName(d);d=a.ajaxifyItems([c]);d.busyItemCallback=a.newdirBusyItemComplete;a.ajax("newdir",d)};a.newdirRWCancel=function(a,c){c.remove()};a.newdirBusyItemComplete=function(a,c,d,e){c=this.response&&this.response.added;var f;c&&c[e]&&(f=c[e][d])&&f[a.name]||a.remove()};a.registerInit("upload",
function(){if(a.permExists("uploadFiles")&&a.conf.uploadExtensions){var b=a.conf.uploadExtensions,c=a.uploadForm=a.htmlEl('<form id="dfm-upload-form" method="post" enctype="multipart/form-data" target="dfm_upload_iframe" accept-charset="UTF-8"><div class="form-row" id="dfm-upload-file-wrapper"><label for="dfm-upload-file">'+a.t("File")+'</label><input type="file" name="files[]" id="dfm-upload-file" multiple /></div><div class="form-row" id="dfm-upload-overwrite-wrapper"><label for="dfm-upload-overwrite"><input type="checkbox" name="uploadOverwrite" id="dfm-upload-overwrite" value="1" checked="checked" /><span class="overwrite-text">'+
a.t("Overwrite existing files")+'</span></label></div><input id="dfm-upload-button" type="submit" value="'+a.t("Upload")+'" name="button" /><input type="hidden" value="upload" name="ajaxOp" /><input type="hidden" name="securityKey" /><input type="hidden" name="activeDir" /><input type="hidden" name="htmlResponse" value="1" /></form>'),d=c.elements;c.action=a.conf.scriptUrl;c.onsubmit=a.eUploadSubmit;"*"!==b[0]&&(d["files[]"].accept="."+b.join(",."));d.securityKey.value=a.conf.securityKey;a.addTbi("upload",
{title:a.t("Upload"),content:c,onclick:a.eUploadTbiClick});a.registerHook("dirActivate","upload",function(b,c){a.tbis.upload.setDisabled(b.readonly||!b.getPerm("uploadFiles"))});a.uploadIsHtml5()&&a.setUploadZone(a.els.contents,{dragenter:a.eContentsUzDragenter,dragleave:a.eContentsUzDragleave,drop:a.eContentsUzDrop})}});a.eContentsUzDragenter=function(b){if(a.tbis.upload.disabled||a.activeDir.busy)return!1;(b=a.els.uploadZone)||(b=a.createLayer("dfm-upload-zone",this,"uploadZone"));this.scrollTop=
0;k(b).fadeIn(300);a.addClass(this,"dragenter")};a.eContentsUzDragleave=function(b){k(a.els.uploadZone).stop(!0,!0).fadeOut(100);a.removeClass(this,"dragenter")};a.eContentsUzDrop=function(b,c,d){a.eUploadZoneDragleave.call(this,b);d&&(k(a.tbis.upload.el).click(),a.activeUpq.selectFiles(d)?k(a.uploadForm.elements.button).click():a.$doc.mousedown())};a.eUploadTbiClick=function(b){var c,d,e,f,g,h,k;c=a.tbis.upload;g=a.uploadForm;e=g.elements;f=a.uploadIsHtml5();b=!f&&a.uploadIsFlash();delete c.onclick;
if(f||b){b&&(a._uploadSwfTbiClosePopup=c.closePopup,c.closePopup=a.uploadSwfTbiClosePopup,a.showEl(c.createPopup()),c.closePopup());g.removeChild(e.activeDir);g.removeChild(e.htmlResponse);e=e["files[]"];c=a.newEl("div");c.id="dfm-upq-wrapper";d=e.parentNode;d.parentNode.insertBefore(c,d);a.hideEl(d);g.onsubmit=a.eUploadQueueSubmit;f="eUpload"+(f?"5":"Swf");g={wrpEl:c,action:g.action,form:g,fieldName:"files[]",accept:e.accept,buttonText:a.t("Add file"),onDomInit:a[f+"DomInit"],onItemStart:a[f+"ItemStart"],
onItemRemove:a[f+"ItemRemove"],onItemComplete:a.eUploadQueueItemComplete,onItemError:a.eUploadQueueItemError,onListSelect:a.eUploadQueueListSelect,onQueueEnd:a.uploadEnd};if(b&&(h=a.conf.swfAuth))for(k in g.data=[],h)g.data.push({name:"swfAuth["+k+"]",value:h[k]});a.activeUpq=new a.Upq(g)}};a.eUploadSubmit=function(b){if(!a.uploadValidate(this))return!1;b=this.elements;a.prepareUploadIframe();b.activeDir.value=a.activeDir.path;a.uploadSetWorking(!0)};a.uploadValidate=function(b){var c,d=b.elements["files[]"];
if(d.files){if(!d.files.length)return!1;for(b=0;c=d.files[b];b++)if(!a.uploadValidateFile(c))return!1;return!0}return d.value?(c={name:d.value.split(-1==d.value.indexOf("/")?"\\":"/").pop()},a.uploadValidateFile(c)):!1};a.uploadValidateFile=function(b){if(!a.uploadForm.elements.uploadOverwrite.checked&&a.activeDir.getItemByName(b.name))return a.setMessage(a.t("%filename already exists.",{"%filename":b.name}));var c=a.conf.uploadMaxSize;return c&&b.size&&b.size>c?(a.setMessage(a.t("%filename (%filesize:formatSize) exceeds the file size limit (%maxsize:formatSize).",
{"%filename":b.name,"%filesize:formatSize":b.size,"%maxsize:formatSize":c})),!1):a.uploadValidateFileExt(b)&&a.validateFileName(b.name)&&!a.isIn(!1,a.invoke("uploadValidateFile",b))?!0:!1};a.uploadValidateFileExt=function(b,c){var d;d=a.conf;var e=null==b.ext?a.fileExt(b.name):b.ext,f=d.execExtensions,g=!d.uploadInsecure;null==c?c=d.uploadExtensions:"string"===typeof c&&(c=c.toLowerCase().split(/[, ]+/));d="*"!==c[0];if(e){if(d){if(g&&f&&a.isIn(e.toLowerCase(),f)&&!a.isIn("txt",c))return a.setMessage(a.t("%filename is not secure.",
{"%filename":b.name})),!1;if(!a.isIn(e.toLowerCase(),c))return a.setMessage(a.t("Allowed file extensions are %extensions.",{"%extensions":c.join(", ")})),!1}}else if(g||d)return a.setMessage(a.t("%filename has no extension.",{"%filename":b.name})),!1;return!0};a.uploadSetWorking=function(b){a.tbis.upload.setWorking(b);a.uploadForm.elements.button.disabled=b};a.prepareUploadIframe=function(){var b=a.uploadIframe;b&&b.parentNode||(b=a.uploadIframe=a.htmlEl('<iframe id="dfm-upload-iframe" name="dfm_upload_iframe" src="javascript: " style="position: absolute; top: -9999px; left: -9999px;"></iframe>'),
l.body.appendChild(b),setTimeout(function(){b.onload=a.eUploadIframeLoad}))};a.eUploadIframeLoad=function(b){a.uploadCompleteData(a.parseIframeResponse(this),!0)};a.uploadCompleteData=function(b,c){var d="string"===typeof b?a.parseTextResponse(b):b;"object"===typeof d?a.uploadCompleteSuccess(d):a.setMessage("<pre>Invalid response from the server:\n"+a.plain(b||"No response!")+"</pre>");c&&a.uploadEnd()};a.uploadCompleteSuccess=function(b){b.added&&a.uploadReset();a.responseAdded(b);a.responseMessages(b)};
a.uploadEnd=function(){a.uploadSetWorking(!1);a.tbis.upload.closePopup()};a.uploadReset=function(){a.activeUpq||a.resetFileInput(a.uploadForm.elements["files[]"])};a.eUploadQueueSubmit=function(b){(b=a.activeUpq)&&!b.isOn&&b.start()&&a.uploadSetWorking(!0);return!1};a.eUploadQueueListSelect=function(b){var c,d,e,f=a.activeDir.path;for(c=0;d=b.list[c];c++)a.uploadValidateFile(d)&&(e||(e={}),e[c]={dir:f,data:[{name:"activeDir",value:f}]});return e};a.eUploadQueueItemComplete=function(b){a.uploadCompleteData(b.data)};
a.eUploadQueueItemError=function(b){a.setMessage(a.t("An error occured during upload of %filename: %type %message",{"%filename":b.item.file.name,"%type":b.errorType,"%message":b.message||""}))};a.uploadSwfTbiClosePopup=function(){var b=this.popup.style;b.top=b.left="-9999em";return a._uploadSwfTbiClosePopup.call(this,"get")};a.eUploadSwfDomInit=function(b){var c,d;c=this.conf;d=this.index;b=this.buttonEl;var e=k(b).children();this.wrpEl.className+=" flash";c={width:c.width||100,height:c.height||25,
id:"dfm-upq-swf-"+d,"class":"dfm-upq-input swf"};d={wmode:"transparent",flashvars:"jscall=dfm.Upq.callInstance&amp;jsid="+d};p.ActiveXObject&&(d.wmode="opaque",c.style="opacity"in l.body.style?"opacity: 0":"filter: alpha(opacity=0)");e.appendTo(this.wrpEl);b.innerHTML=a.Flash.createHtml(a.conf.swfupSrc,c,d);this.swfEl=b.firstChild;e.prependTo(b)};a.eUploadSwfItemStart=function(a){a=this.getItemConf(a.item);return this.swfEl.uploadFile&&this.swfEl.uploadFile(a.fid,a.action,a.fieldName,a.data)};a.eUploadSwfItemRemove=
function(a){this.swfEl.removeFile&&this.swfEl.removeFile(a.item.fid)};a.eUpload5DomInit=function(b){this.wrpEl.className+=" html5";b=this.inputEl=a.newEl("input");b.className="dfm-upq-input";b.type="file";b.multiple=!0;this.conf.accept&&(b.accept=this.conf.accept);b.onchange=a.eUpload5InputChange;b.upqIndex=this.index;this.buttonEl.appendChild(b)};a.eUpload5ItemStart=function(b){var c,d,e,f=this.getItemConf(b.item),g=f.fid,h=this.index;e=new FormData;for(c=0;d=f.data[c];c++)d.name&&e.append(d.name,
d.value);e.append(f.fieldName,f.file);b.item.xhr=k.ajax({url:f.action,type:"POST",dataType:"json",data:e,processData:!1,contentType:!1,beforeSend:function(b){b.upload.onprogress=function(b){a.Upq.instances[h].fileProgress(g,b.loaded,b.total)};b=null},success:function(b){a.Upq.instances[h].fileComplete(g,b)},error:function(b,c,d){"error"===c&&(c="HTTP"+(b.status?"-"+b.status:""));a.Upq.instances[h].fileError(g,c,d||b.statusText)}});b=d=e=f=null;return!0};a.eUpload5ItemRemove=function(a){a.item.xhr&&
a.item.xhr.abort()};a.eUpload5InputChange=function(b){if(b=a.Upq.instances[this.upqIndex])b.selectFiles(this.files),a.resetFileInput(this)};a.uploadIsHtml5=function(){var b=a._uploadIsHtml5;if(b===q)try{b=a._uploadIsHtml5=!(!p.FormData||!(new XMLHttpRequest).upload)}catch(c){}return b};a.uploadIsFlash=function(){return!!a.conf.swfupSrc&&9<=a.Flash.getVersion()};a.resetFileInput=function(b){if(k(b).val("").val()){var c=a.newEl("form"),d=b.parentNode;c.style.display="none";d.insertBefore(c,b);c.appendChild(b);
c.reset();d.insertBefore(b,c);d.removeChild(c)}};a.imgSubmitItemOp=function(b,c,d,e,f){if(c&&!c.busy&&!(d.w==c.width&&d.h==c.height||1>d.w||1>d.h||!a.imgValidateMaxDim(d.w,d.h)||e&&!e.apply(this,arguments))){var g=a.ajaxifyItems([c]);a.extend(g.data,d);a.ajax(b,g);f&&f.apply(this,arguments);return!0}};a.imgAddCopyEl=function(b,c){var d=b.elements.s,e=a.htmlEl('<div class="form-row" id="dfm-'+c+'-cp-wrapper"><label for="dfm-'+c+'-cp"><input type="checkbox" name="cp" id="dfm-'+c+'-cp" value="1" /><span class="cp-text">'+
a.t("Create a copy")+"</span></label></div>");d&&d.parentNode.insertBefore(e,d);return e};a.imgAddToggleEl=function(b){var c=a.htmlEl('<div class="tg"><span></span></div>');c.onclick=function(){k(b).toggleClass("collapsed").children(".elements").slideToggle()};b.appendChild(c);return c};a.imgValidateMaxDim=function(b,c,d){var e,f=a.conf.imgMaxDim;return f&&"0"!==f&&(e=f.split("x"),e[0]&&b>e[0]||e[1]&&c>e[1])?(d||a.setMessage(a.t("Dimensions can not exceed %maxdim.",{"%maxdim":f})),!1):!0};a.imgCreateWidget=
function(b){b=a.createLayer("dfm-"+b+"-widget",!1,b+"IW",b);b.className+=" img-widget";b.tabIndex=0;b.onkeydown=a.eImgWidgetKeydown;b.onscroll=a.eImgWidgetScroll;return b};a.imgPrepareItemWidget=function(b,c){var d,e=c.Form.elements;c.Item=b;c.ActiveEl=l.activeElement;c.insertBefore(c.Img=a.htmlEl('<img src="'+b.getUrl(!1,!0)+'" class="wimg" />'),c.firstChild);c.Img.onmousedown=a.returnFalse;e.cp&&(d=k(e.cp).closest("div")[0])&&(d.style.display=(e.cp.disabled=!(a.conf.imgCopy||b.parent.getPerm("copyFiles")))?
"none":"");a.setPageOverlay(!0,a.imgHideWidget,c);a.imgSetWidgetOffset(c);k([c,e[0]]).focus();return c};a.imgSetWidgetOffset=function(b){var c=b.Form,d=b.Item,e={left:0,top:0},f=a.winSize(),g=a.winScroll();e.width=Math.min(d.width,.8*f.width);e.height=Math.min(d.height,.8*f.height);e.width==d.width&&e.height!=d.height&&(e.width+=a.scrollbarWidth());e.height==d.height&&e.width!=d.width&&(e.height+=a.scrollbarWidth());a.showAt(b,e);b.style.left=g.left+Math.max(0,(f.width-b.offsetWidth)/2)+"px";b.style.top=
g.top+Math.max(0,(f.height-b.offsetHeight)/2)+"px";c.style.left=(c.startX=Math.max(0,(b.clientWidth-c.offsetWidth)/2))+"px";k.browser.safari&&(b.style.overflow="hidden",setTimeout(function(){b.style.overflow="auto"}))};a.imgHideWidget=function(b){b&&b.Item&&(a.hideEl(b),a.setPageOverlay(!1),b.removeChild(b.Img),b.Item=b.Img=null,b.ActiveEl&&setTimeout(function(){k(b.ActiveEl).focus()}));return b};a.eImgWidgetScroll=function(b){var c=this;a.imgWidgetScroll(c);setTimeout(function(){a.imgWidgetScroll(c)})};
a.imgWidgetScroll=function(a){var c=a.Form;c.style.top=a.scrollTop+"px";c.style.left=c.startX+a.scrollLeft+"px"};a.eImgWidgetKeydown=function(b){b=b||p.event;13==b.keyCode?(b.target||b.srcElement).form||k(this.Form.elements.s).click():27==b.keyCode&&a.imgHideWidget(this)};a.imgOpSelectedItemValidate=function(b,c){c||(c=a.activeDir.getFirstSelectedItem());if(c&&c.width&&c.height&&c.isOperable()&&c.parent&&!c.parent.busy&&c.parent.getPerm(b))return c};a.imgOpSelectedItem=function(b,c){if(c=a.imgOpSelectedItemValidate(b,
c))a[b+"ShowWidget"](c)};a.registerInit("resize",function(){a.permExists("resize")&&a.conf.imgExtensions&&a.addCmi("resize",{title:a.t("Resize"),onclick:function(b,c){c.itemCM&&a.imgOpSelectedItem("resize",c.target)},stateCallback:function(b){if(b.itemCM)return a.imgOpSelectedItemValidate("resize",b.target)}})});a.eResizeSubmit=function(b){b=this.elements;a.imgSubmitItemOp("resize",a.els.resizeIW.Item,{w:1*b.w.value,h:1*b.h.value,cp:b.cp&&b.cp.checked?1:0},a.resizeValidateItemOp,a.resizeHideWidget);
return!1};a.resizeValidateItemOp=function(b,c,d){return!a.conf.imgUpscale&&(d.w>c.width||d.h>c.height)?a.setMessage(a.t("Upscaling is not allowed.")):!0};a.resizeShowWidget=function(b){var c=a.resizeCreateWidget();a.imgPrepareItemWidget(b,c);a.resizeResetWidget();a.setDragDrop(c.Img,a.eResizeImgDrag,a.eResizeImgDrop,a.eResizeImgDown);return c};a.resizeCreateWidget=function(){var b=a.els.resizeIW,c,d;b||(b=a.imgCreateWidget("resize"),c=b.Form=a.htmlEl('<form id="dfm-resize-form"><div class="elements"><div class="form-row" id="dfm-resize-dim-wrapper"><label for="dfm-resize-w">'+
a.t("Dimensions")+'</label><input type="text" name="w" id="dfm-resize-w" size="3" maxlength="5" /><span class="isep">x</span><input type="text" name="h" id="dfm-resize-h" size="3" maxlength="5" /></div><div class="form-row" id="dfm-resize-ar-wrapper"><label for="dfm-resize-ar"><input type="checkbox" name="ar" id="dfm-resize-ar" value="1" checked="checked" /><span class="ar-text">'+a.t("Proportional")+'</span></label></div><input id="dfm-resize-s" type="submit" value="'+a.t("Resize")+'" name="s" /><input id="dfm-resize-r" type="button" value="'+
a.t("Reset")+'" name="r" /><input id="dfm-resize-c" type="button" value="'+a.t("Cancel")+'" name="c" /></div></form>'),d=c.elements,a.imgAddCopyEl(c,"resize"),a.imgAddToggleEl(c),c.onsubmit=a.eResizeSubmit,d.c.onclick=a.resizeHideWidget,d.r.onclick=a.resizeResetWidget,d.w.onkeyup=d.h.onkeyup=a.eResizeIWInputKeyup,d.ar.onclick=a.eResizeARClick,b.appendChild(c),l.body.appendChild(b));return b};a.resizeHideWidget=function(){a.imgHideWidget(a.els.resizeIW)};a.resizeResetWidget=function(){var b=a.els.resizeIW,
c=b.Form.elements,b=b.Item;c.w.value=b.width;c.h.value=b.height;a.resizeUpdateWidgetImg()};a.resizeUpdateWidgetImg=function(){var b=a.els.resizeIW,c=b.Form.elements,b=b.Img,d=1*c.w.value,c=1*c.h.value;b.style.width=d?d+"px":"auto";b.style.height=c?c+"px":"auto"};a.eResizeIWInputKeyup=function(b){b=a.els.resizeIW;var c=b.Item,d=b.Form.elements;b=1*this.value;var e=a.conf.imgUpscale,f,g,h;c&&b&&(this===d.w?(h=c.width,g=c.height,c=d.h):(h=c.height,g=c.width,c=d.w),d.ar.checked&&(f=g/h),b>h&&!e&&(b=h),
d=1*c.value,f&&(d=Math.round(b*f)),d>g&&!e&&(d=g,f&&(b=Math.round(d/f))),this.value=b,c.value=d,a.resizeUpdateWidgetImg())};a.eResizeARClick=function(b){this.checked&&a.eResizeIWInputKeyup.call(this.form.elements.w,b)};a.eResizeImgDown=function(b){this.StartX=b.pageX;this.StartY=b.pageY;this.StartW=this.offsetWidth;this.StartH=this.offsetHeight;a.addClass(a.els.resizeIW,"img-mdown")};a.eResizeImgDrag=function(b){var c=a.els.resizeIW,d=c.Img,c=c.Form.elements,e=Math.floor(b.pageX-d.StartX),f=Math.floor(b.pageY-
d.StartY),g=Math.max(1,d.StartW+e),d=Math.max(1,d.StartH+f);c.w.value=g;c.h.value=d;a.eResizeIWInputKeyup.call(Math.abs(e)>Math.abs(f)?c.w:c.h,b)};a.eResizeImgDrop=function(b){a.removeClass(a.els.resizeIW,"img-mdown")};a.registerInit("crop",function(){a.permExists("crop")&&a.conf.imgExtensions&&a.addCmi("crop",{title:a.t("Crop"),onclick:function(b,c){c.itemCM&&a.imgOpSelectedItem("crop",c.target)},stateCallback:function(b){if(b.itemCM)return a.imgOpSelectedItemValidate("crop",b.target)}})});a.eCropSubmit=
function(b){b=this.elements;a.imgSubmitItemOp("crop",a.els.cropIW.Item,{x:1*b.x.value,y:1*b.y.value,w:1*b.w.value,h:1*b.h.value,cp:b.cp&&b.cp.checked?1:0},a.cropValidateItemOp,a.cropHideWidget);return!1};a.cropValidateItemOp=function(a,c,d){return!(0>d.x||0>d.y||c.width<d.x+d.w||c.height<d.y+d.h)};a.cropShowWidget=function(b){var c=a.cropCreateWidget();a.imgPrepareItemWidget(b,c);c.Box.style.backgroundImage="url("+c.Img.src+")";a.cropResetWidget();return c};a.cropCreateWidget=function(){var b=a.els.cropIW,
c,d;b||(b=a.imgCreateWidget("crop"),c=b.Box=a.htmlEl('<div id="dfm-crop-box"><div class="edge h t"></div><div class="edge v r"></div><div class="edge h b"></div><div class="edge v l"></div><div class="resizer"></div></div>'),a.setDragDrop(c,a.eCropBoxDrag,a.eCropBoxDrop),a.setDragDrop(c.lastChild,a.eCropResizerDrag,a.eCropResizerDrop,a.eCropResizerDown),b.appendChild(c),c=b.Form=a.htmlEl('<form id="dfm-crop-form"><div class="elements"><div class="form-row" id="dfm-crop-pos-wrapper"><label for="dfm-crop-x">'+
a.t("Offset")+'</label><input type="text" name="x" id="dfm-crop-x" size="3" maxlength="5" /><span class="isep pos">:</span><input type="text" name="y" id="dfm-crop-y" size="3" maxlength="5" /></div><div class="form-row" id="dfm-crop-dim-wrapper"><label for="dfm-crop-w">'+a.t("Dimensions")+'</label><input type="text" name="w" id="dfm-crop-w" size="3" maxlength="5" /><span class="isep">x</span><input type="text" name="h" id="dfm-crop-h" size="3" maxlength="5" /></div><input id="dfm-crop-s" type="submit" value="'+
a.t("Crop")+'" name="s" /><input id="dfm-crop-c" type="button" value="'+a.t("Cancel")+'" name="c" /></div></form>'),d=c.elements,a.imgAddCopyEl(c,"crop"),a.imgAddToggleEl(c),c.onsubmit=a.eCropSubmit,d.c.onclick=a.cropHideWidget,d.x.onkeyup=d.y.onkeyup=d.w.onkeyup=d.h.onkeyup=a.eCropIWInputKeyup,b.appendChild(c),l.body.appendChild(b));return b};a.cropHideWidget=function(){a.imgHideWidget(a.els.cropIW)};a.cropUpdateWidgetBox=function(){var b=a.els.cropIW,c=b.Form.elements;a.setCss(b.Box,{width:1*c.w.value||
1,height:1*c.h.value||1,left:1*c.x.value,top:1*c.y.value},"px");a.cropUpdateWidgetBoxBg()};a.cropUpdateWidgetBoxBg=function(){var b=a.els.cropIW.Box.style;b.backgroundPosition="-"+b.left+" -"+b.top};a.cropUpdateWidgetInput=function(){var b=a.els.cropIW,c=b.Box.style,b=b.Form.elements;b.x.value=a.int(c.left);b.y.value=a.int(c.top);b.w.value=a.int(c.width);b.h.value=a.int(c.height)};a.cropResetWidget=function(){var b=a.els.cropIW,c=b.Form.elements,d=b.Item,e,f,g,h;e=1*(c.x.value||Math.round(b.clientWidth/
2-50));e>d.width-16&&(e=0);f=1*(c.y.value||Math.round(b.clientHeight/2-50));f>d.height-16&&(f=0);g=1*(c.w.value||100);e+g>d.width&&(g=d.width-e);h=1*(c.h.value||100);f+h>d.height&&(h=d.height-f);c.x.value=e;c.y.value=f;c.w.value=g;c.h.value=h;b.Img.style.width=d.width+"px";b.Img.style.height=d.height+"px";a.cropUpdateWidgetBox()};a.eCropIWInputKeyup=function(b){var c=a.els.cropIW;b=c.Box.style;var c=c.Item,d=this.name,e=a.int(this.value);this.value&&("x"==d?this.value=Math.min(Math.max(e,0),c.width-
a.int(b.width)):"y"==d?this.value=Math.min(Math.max(e,0),c.height-a.int(b.height)):"w"==d?this.value=Math.min(Math.max(e,1),c.width-a.int(b.left)):"h"==d&&(this.value=Math.min(Math.max(e,1),c.height-a.int(b.top))));a.cropUpdateWidgetBox()};a.eCropBoxDrag=function(b){var c=a.els.cropIW,d=c.Box,e=c.Item;a.cropDragging||(a.cropDragging=1,a.cropPrepareDragScroll(b,c,d,75,75));a.eInnerDragAutoScroll(b,c);d.style.left=Math.min(Math.max(d.startL+b.pageX+c.scrollLeft-d.startX,0),e.width-d.startW)+"px";d.style.top=
Math.min(Math.max(d.startT+b.pageY+c.scrollTop-d.startY,0),e.height-d.startH)+"px";a.cropUpdateWidgetBoxBg();a.cropUpdateWidgetInput()};a.eCropBoxDrop=function(b){a.cropDragging=0};a.eCropResizerDown=function(a){a.stopPropagation()};a.eCropResizerDrag=function(b){var c=a.els.cropIW,d=c.Box,e=c.Item;a.cropResizeDragging||(a.cropResizeDragging=1,a.cropPrepareDragScroll(b,c,d,50,50));a.eInnerDragAutoScroll(b,c);d.style.width=Math.min(Math.max(d.startW+b.pageX+c.scrollLeft-d.startX,20),e.width-d.startL)+
"px";d.style.height=Math.min(Math.max(d.startH+b.pageY+c.scrollTop-d.startY,20),e.height-d.startT)+"px";a.cropUpdateWidgetInput()};a.eCropResizerDrop=function(b){a.cropResizeDragging=0};a.cropPrepareDragScroll=function(b,c,d,e,f){a.prepareForInnerDragAutoScroll(c,e,f);d.startX=b.pageX+c.scrollLeft;d.startY=b.pageY+c.scrollTop;d.startL=a.int(d.style.left);d.startT=a.int(d.style.top);d.startW=a.int(d.style.width);d.startH=a.int(d.style.height)};var h=a.search={data:{}};a.registerInit("search",function(){if(a.conf.searchOn){var b=
h.form=a.htmlEl('<form id="dfm-search-form" method="post" accept-charset="UTF-8"><div class="form-row" id="dfm-search-keys-wrapper"><input type="text" name="keys" id="dfm-search-keys" size="18" maxlength="64" /><input id="dfm-search-op" type="submit" value="'+a.t("Search")+'" name="op" /><input id="dfm-search-cancel-op" type="button" value="'+a.t("Cancel")+'" title="'+a.t("Cancel")+'" name="cancelOp" style="display:none" /></div><input type="hidden" name="activeDir" /></form>');b.onsubmit=h.eSubmit;
b.elements.cancelOp.onclick=h.eCancel;h.Tbi=a.addTbi("search",{title:a.t("Search"),content:b,onopen:h.eTbiOpen});a.registerHook("dirActivate","search",function(a,b){var e=h.Tbi;e.setDisabled(a.disabled);e.popupOn&&h.setDir(a)});a.shortcuts.contents.ctrl.k70=a.shortcuts.tree.ctrl.k70=function(a){h.Tbi.click(a)}}});h.setDir=function(b){if(!(h.working||b.disabled||h.Tbi.disabled)){var c=h.form.elements,d=h.data,e=b===h.ConDir;e&&(c.keys.value=d.keys,b=a.tree[d.activeDir]);b&&b.path&&b.path!==c.activeDir.value&&
(c.activeDir.value=b.path,c.keys.placeholder=c.keys.title=c.op.title=a.t("Search in !dirname",{"!dirname":b.name}),e||(c.keys.value=""))}};h.eTbiOpen=function(b){h.setDir(a.activeDir);h.form.elements.keys.focus()};h.validateForm=function(b){var c=b.elements;b=a.tree[c.activeDir.value];if(!b||b.disabled)return!1;b=c.keys;return/^\**$|[\/\x00]/.test(b.value)?(b.offsetWidth&&b.focus(),!1):!0};h.eSubmit=function(b){if(!h.validateForm(this))return!1;h.start(a.formDataObj(this));return!1};h.eCancel=function(a){h.end()};
h.start=function(b){var c,d,e,f=h.getConDir();h.end();h.data=b;h.setWorking(!0);f.empty();e=h.prepareScanOpt(b);h.scanDir(a.tree[b.activeDir],e);if(d=e.items.length){for(c=0;c<d;c++)f.appendItem(e.items[c]);f.sortItems(null,null,!0)}f.branchHeadEl.title=a.t("Search results for !keys in !dirname",{"!keys":b.keys,"!dirname":a.tree[b.activeDir].name});f.open();e.skipped.length?(h.ajaxOpt=h.prepareAjaxOpt(a.extend({"dirnames[]":e.skipped},b)),h.xhr=a.ajax("search",h.ajaxOpt)):h.end();return!1};h.scanDir=
function(a,c){var d,e,f=a.path;if(f&&!a.disabled)if(a.content){for(d=0;e=a.itemsArray[d];d++)c.callback(e,c)&&c.items.push(e);c.scanned.push(f)}else c.skipped.push(f);if(!c.data.shallow)for(d in a.subdirs)h.scanDir(a.subdirs[d],c)};h.prepareScanOpt=function(a){var c=a.keys.replace(/[\\\^\$\+\?\.\(\)\[\]\{\}\|\:]/g,"\\$&"),c=-1===c.indexOf("*")?".*"+c+".*":c.replace(/\*+/g,".*");return{data:a,items:[],scanned:[],skipped:[],callback:h.matchItem,re:new RegExp("^"+c+"$",a.caseSensitive?"":"i")}};h.getConDir=
function(){var b,c=h.ConDir;c||(c=h.ConDir=new a.ConDir(a.t("Search results")),c.branchEl.className+=" search-dir",c.contentEl.className+=" search-content",c.formatFullPath=h.formatPath,b=a.els.tree,b.insertBefore(c.branchEl,b.firstChild));return c};h.setWorking=function(b){var c=h.form.elements;h.working=b;h.Tbi.setWorking(b);c.op.disabled=b;c.op.style.display=b?"none":"";c.cancelOp.style.display=b?"":"none";a[b?"addClass":"removeClass"](h.ConDir.branchHeadEl,"busy")};h.end=function(){if(h.working){var b=
h.ConDir,c;h.setWorking(!1);h.ajaxAbort();b&&((c=b.itemsArray.length)?a.setMessage(1==c?a.t("Found 1 item."):a.t("Found !count items.",{"!count":c}),"status"):a.setMessage(a.t("No results found.")))}};h.ajaxAbort=function(){var a=h.xhr,c=h.ajaxOpt;a&&c&&(a.abort(),a===h.xhr&&c.completeCallback.call(c,a,"aborted"))};h.prepareAjaxOpt=function(a){return{data:a,completeCallback:h.ajaxComplete}};h.ajaxComplete=function(b,c){if(h.xhr===b){delete h.xhr;delete h.ajaxOpt;var d=this.response,e,f,g,k,l,n,p,
q;if(d&&(e=d.added)){q=["files","subdirs"];for(f in e)if(g=a.tree[f])for(p in d=e[f],q)if(k=d[q[p]])for(l in k)(n=g.getItemByName(l))&&h.ConDir.appendItem(n);h.ConDir.maySortItems()}h.end()}};h.formatPath=function(){var b=h.data,c=a.tree[b.activeDir];return c?a.t("Search results for !keys in !dirname",{"!keys":a.emplain(b.keys),"!dirname":a.emplain(c.name)}):h.ConDir.formatName()};h.matchItem=function(a,c){return c.re.test(a.name)};a.registerInit("download",function(){(a.permExists("downloadFiles")||
a.permExists("downloadFolders"))&&a.addCmi("download",{title:a.t("Download"),onclick:function(b,c){c.treeCM?a.downloadDir(c.target):c.itemCM&&a.downloadSelectedItems()},stateCallback:function(b){if(!a.downloadRequest){if(b.treeCM)return a.downloadDirValidate(b.target);if(b.itemCM)return a.downloadSelectedItemsValidate(!0)}}})});a.downloadSelectedItemsValidate=function(b){return!a.activeDir.busy&&a.validateSelectionCommon("downloadFiles","downloadFolders",!0,!1,b)};a.downloadSelectedItems=function(){a.downloadSelectedItemsValidate()&&
a.downloadItems(a.getSelectedItems())};a.downloadDirValidate=function(b){return a.validateSelectedDir(b,"downloadFolders")};a.downloadDir=function(b){a.downloadDirValidate(b)&&a.downloadItems([b])};a.downloadItems=function(b){if(!a.downloadRequest){var c,d,e,f,g=a.ajaxifyItems(b);if(g){b=a.downloadGetForm();e=b.elements;e.download_token.value=g.download_token="download"+1*new Date;e.securityKey.value=a.conf.securityKey;f=k(".data-wrapper",b).empty();for(d in g.data)if(e=g.data[d],a.isArray(e))for(c in e)f.append(a.downloadDataInput(d,
e[c]));else f.append(a.downloadDataInput(d,e));g.responseTimer=setInterval(a.downloadCheckResponse,1E3);g.resetTimer=setTimeout(a.downloadResetRequest,6E4);a.downloadRequest=g;b.submit()}}};a.downloadCheckResponse=function(){a.downloadRequest&&a.downloadRequest.download_token===a.cookie("download_token")&&a.downloadIframeLoad.call(a.downloadIframe)};a.downloadResetRequest=function(){var b=a.downloadRequest;b&&(a.downloadRequest=null,clearInterval(b.responseTimer),clearTimeout(b.resetTimer),a.busyComplete.call(b),
a.cookie("download_token","",-7,"/"),k(".data-wrapper",a.downloadForm).empty())};a.downloadGetForm=function(){if(a.downloadForm)return a.downloadForm;a.downloadIframe=k('<iframe name="dfm_download_iframe" src="javascript: " style="position: absolute; top: -9999px; left: -9999px;"></iframe>').appendTo(l.body).load(a.downloadIframeLoad)[0];return a.downloadForm=k('<form method="post" target="dfm_download_iframe" accept-charset="UTF-8" style="position: absolute; top: -9999px; left: -9999px;"><div class="data-wrapper"></div><input type="hidden" value="download" name="ajaxOp" /><input type="hidden" name="htmlResponse" value="1" /><input type="hidden" name="securityKey" /><input type="hidden" name="download_token" /></form>').attr("action",
a.conf.scriptUrl).appendTo(l.body)[0]};a.downloadIframeLoad=function(b){a.downloadResetRequest();(b=a.parseIframeResponse(this))&&a.responseMessages(b)};a.downloadDataInput=function(a,c){var d=l.createElement("input");d.type="hidden";d.name=a;d.value=c;return d}})(window.jQuery,window,document);
